<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>True Cost Calculator | Premium Financial Planning</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700;800&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-dark: #0a0e1a;
            --secondary-dark: #1a1f2e;
            --accent-dark: #2a3441;
            --gold-accent: #d4af37;
            --silver-accent: #c0c0c0;
            --text-primary: #ffffff;
            --text-secondary: #a0aec0;
            --success-green: #10b981;
            --danger-red: #ef4444;
        }
        * {
            box-sizing: border-box;
        }
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--secondary-dark) 100%);
            color: var(--text-primary);
            min-height: 100vh;
        }
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Playfair Display', serif;
        }
        .premium-gradient {
            background: linear-gradient(135deg, var(--secondary-dark) 0%, var(--accent-dark) 100%);
        }
        .gold-gradient {
            background: linear-gradient(135deg, var(--gold-accent) 0%, #f4e19c 100%);
        }
        .tab-active {
            border-color: var(--gold-accent);
            color: var(--gold-accent);
            background-color: rgba(212, 175, 55, 0.1);
        }
        .result-card {
            background: rgba(26, 31, 46, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(212, 175, 55, 0.2);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .result-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 25px 50px -12px rgba(212, 175, 55, 0.25);
            border-color: rgba(212, 175, 55, 0.4);
        }
        .hidden {
            display: none;
        }
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px;
            background: rgba(212, 175, 55, 0.2);
            border-radius: 5px;
            outline: none;
            opacity: 0.8;
            transition: opacity 0.3s;
        }
        input[type="range"]:hover {
            opacity: 1;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            background: var(--gold-accent);
            cursor: pointer;
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
        }
        input[type="range"]::-moz-range-thumb {
            width: 24px;
            height: 24px;
            background: var(--gold-accent);
            cursor: pointer;
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
        }
        .quiz-option {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(212, 175, 55, 0.2);
        }
        .quiz-option:hover {
            transform: scale(1.03);
            border-color: var(--gold-accent);
            background: rgba(212, 175, 55, 0.05);
        }
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 300px;
            background: var(--accent-dark);
            color: var(--text-primary);
            text-align: center;
            border-radius: 8px;
            padding: 12px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -150px;
            opacity: 0;
            transition: all 0.3s;
            font-size: 14px;
            border: 1px solid rgba(212, 175, 55, 0.3);
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        .health-score {
            background: conic-gradient(var(--gold-accent) 0% var(--score), rgba(212, 175, 55, 0.2) var(--score) 100%);
            border-radius: 50%;
            width: 150px;
            height: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        .health-score::before {
            content: "";
            position: absolute;
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background-color: var(--secondary-dark);
        }
        .health-score-text {
            position: relative;
            z-index: 1;
            font-size: 24px;
            font-weight: bold;
        }
        .progress-ring {
            transform: rotate(-90deg);
        }
        .progress-ring-circle {
            transition: stroke-dashoffset 0.35s;
            stroke: var(--gold-accent);
            stroke-width: 4;
            fill: transparent;
        }
        .mobile-optimized {
            touch-action: manipulation;
        }
        .mobile-optimized input, .mobile-optimized button {
            min-height: 44px;
        }
        @media (max-width: 768px) {
            .mobile-optimized .grid {
                grid-template-columns: 1fr;
            }
            .mobile-optimized .text-4xl {
                font-size: 2rem;
            }
            .mobile-optimized .text-3xl {
                font-size: 1.75rem;
            }
            .mobile-optimized .text-2xl {
                font-size: 1.5rem;
            }
        }
        .asset-allocation {
            display: flex;
            align-items: center;
            margin-bottom: 0.75rem;
        }
        .asset-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .asset-info {
            flex: 1;
        }
        .asset-name {
            font-weight: 500;
            font-size: 0.875rem;
        }
        .asset-return {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }
        .asset-value {
            font-weight: 500;
            font-size: 0.875rem;
            min-width: 45px;
            text-align: right;
        }
        /* Premium Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .fade-in-up {
            animation: fadeInUp 0.6s ease-out;
        }
        @keyframes goldGlow {
            0%, 100% {
                box-shadow: 0 0 20px rgba(212, 175, 55, 0.3);
            }
            50% {
                box-shadow: 0 0 40px rgba(212, 175, 55, 0.6);
            }
        }
        .gold-glow {
            animation: goldGlow 3s ease-in-out infinite;
        }
        /* Premium Form Styles */
        .premium-input {
            background: rgba(26, 31, 46, 0.6);
            border: 1px solid rgba(212, 175, 55, 0.2);
            color: var(--text-primary);
            transition: all 0.3s;
        }
        .premium-input:focus {
            outline: none;
            border-color: var(--gold-accent);
            box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1);
        }
        .premium-button {
            background: linear-gradient(135deg, var(--gold-accent) 0%, #f4e19c 100%);
            color: var(--primary-dark);
            font-weight: 600;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        .premium-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: left 0.5s;
        }
        .premium-button:hover::before {
            left: 100%;
        }
        .premium-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(212, 175, 55, 0.3);
        }
        /* Educational Tooltip Styles */
        .edu-tooltip {
            position: relative;
            display: inline-block;
            cursor: pointer;
        }
        .edu-tooltip .edu-tooltip-content {
            visibility: hidden;
            width: 350px;
            background: var(--accent-dark);
            color: var(--text-primary);
            text-align: left;
            border-radius: 12px;
            padding: 16px;
            position: absolute;
            z-index: 1000;
            bottom: 125%;
            left: 50%;
            margin-left: -175px;
            opacity: 0;
            transition: all 0.3s;
            font-size: 14px;
            border: 1px solid rgba(212, 175, 55, 0.3);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }
        .edu-tooltip:hover .edu-tooltip-content {
            visibility: visible;
            opacity: 1;
        }
        /* Scenario Comparison Table */
        .scenario-table {
            background: rgba(26, 31, 46, 0.6);
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid rgba(212, 175, 55, 0.2);
        }
        .scenario-table th {
            background: rgba(212, 175, 55, 0.1);
            padding: 12px;
            text-align: left;
            font-weight: 600;
            border-bottom: 1px solid rgba(212, 175, 55, 0.2);
        }
        .scenario-table td {
            padding: 12px;
            border-bottom: 1px solid rgba(212, 175, 55, 0.1);
        }
        .scenario-table tr:last-child td {
            border-bottom: none;
        }
        /* Chart Container Styles */
        .chart-container {
            position: relative;
            background: rgba(26, 31, 46, 0.4);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(212, 175, 55, 0.2);
        }
        /* Loading Animation */
        .loading-spinner {
            border: 3px solid rgba(212, 175, 55, 0.2);
            border-radius: 50%;
            border-top: 3px solid var(--gold-accent);
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Exclusive Badge */
        .exclusive-badge {
            background: linear-gradient(135deg, var(--gold-accent) 0%, #f4e19c 100%);
            color: var(--primary-dark);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
            margin-left: 8px;
        }
        /* Footer Styles */
        .premium-footer {
            background: rgba(10, 14, 26, 0.8);
            border-top: 1px solid rgba(212, 175, 55, 0.2);
            padding: 2rem 0;
            margin-top: 4rem;
        }
        .brand-logo {
            font-family: 'Playfair Display', serif;
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--gold-accent) 0%, #f4e19c 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: inline-block;
        }
        .disclaimer {
            font-size: 0.875rem;
            color: var(--text-secondary);
            line-height: 1.5;
            border-left: 3px solid var(--gold-accent);
            padding-left: 1rem;
            margin-top: 1rem;
        }
        
        /* Debt Progress Timeline Styles - MODIFIED */
        .debt-timeline {
            position: relative;
            padding: 40px 0; /* Increased padding to prevent title overlap */
            margin-top: 20px; /* Added margin top for additional space */
        }
        .timeline-track {
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 8px;
            background: rgba(212, 175, 55, 0.2);
            border-radius: 4px;
            transform: translateY(-50%);
        }
        .timeline-progress {
            position: absolute;
            top: 50%;
            left: 0;
            height: 8px;
            background: linear-gradient(90deg, var(--gold-accent), #f4e19c);
            border-radius: 4px;
            transform: translateY(-50%);
            transition: width 0.5s ease;
        }
        .timeline-milestone {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 24px;
            height: 24px;
            background: var(--secondary-dark);
            border: 3px solid var(--gold-accent);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            color: var(--gold-accent);
        }
        .timeline-milestone.completed {
            background: var(--gold-accent);
            color: var(--primary-dark);
        }
        .milestone-label {
            position: absolute;
            top: -40px;
            transform: translateX(-50%);
            background: var(--accent-dark);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            border: 1px solid rgba(212, 175, 55, 0.3);
        }
        .milestone-date {
            position: absolute;
            bottom: -30px;
            transform: translateX(-50%);
            font-size: 11px;
            color: var(--text-secondary);
            white-space: nowrap;
        }
        
        /* Debt Strategy Comparison Styles */
        .strategy-card {
            background: rgba(26, 31, 46, 0.6);
            border: 2px solid rgba(212, 175, 55, 0.2);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }
        .strategy-card:hover {
            border-color: var(--gold-accent);
            transform: translateY(-4px);
            box-shadow: 0 10px 25px rgba(212, 175, 55, 0.2);
        }
        .strategy-card.selected {
            border-color: var(--gold-accent);
            background: rgba(212, 175, 55, 0.1);
        }
        .strategy-card.recommended {
            border-color: var(--success-green);
            position: relative;
        }
        .strategy-card.recommended::before {
            content: "RECOMMENDED";
            position: absolute;
            top: -10px;
            right: 20px;
            background: var(--success-green);
            color: var(--primary-dark);
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: bold;
        }
        .strategy-card.recommended .view-details-btn {
            display: none;
        }
        
        /* Debt Analysis Dashboard Styles - MODIFIED */
        .metric-card {
            background: rgba(26, 31, 46, 0.4);
            border: 1px solid rgba(212, 175, 55, 0.2);
            border-radius: 8px;
            padding: 16px;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
        }
        .metric-card:hover {
            border-color: rgba(212, 175, 55, 0.4);
            transform: translateY(-2px);
        }
        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--gold-accent);
            margin: 8px 0;
        }
        .metric-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .metric-change {
            font-size: 0.75rem;
            margin-top: 4px;
        }
        .metric-change.positive {
            color: var(--success-green);
        }
        .metric-change.negative {
            color: var(--danger-red);
        }
        .metric-info-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 20px;
            height: 20px;
            background: rgba(212, 175, 55, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--gold-accent);
        }
        .metric-info-btn:hover {
            background: rgba(212, 175, 55, 0.4);
        }
        .metric-tooltip {
            position: absolute;
            top: 30px;
            right: 10px;
            width: 250px;
            background: var(--accent-dark);
            border: 1px solid rgba(212, 175, 55, 0.3);
            border-radius: 8px;
            padding: 10px;
            font-size: 12px;
            color: var(--text-primary);
            z-index: 100;
            display: none;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        /* Fixed CSS selector to target child tooltip */
        .metric-info-btn:hover .metric-tooltip {
            display: block;
        }
        
        /* Individual Loan Styles - NEW */
        .loan-item {
            background: rgba(26, 31, 46, 0.6);
            border: 1px solid rgba(212, 175, 55, 0.2);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            position: relative;
        }
        .loan-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .loan-item-title {
            font-weight: 600;
            color: var(--gold-accent);
        }
        .loan-item-remove {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger-red);
            border: none;
            border-radius: 4px;
            padding: 4px 8px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }
        .loan-item-remove:hover {
            background: rgba(239, 68, 68, 0.4);
        }
        .loan-item-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        .loan-item-detail {
            display: flex;
            flex-direction: column;
        }
        .loan-item-detail label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }
        .loan-item-detail input {
            background: rgba(26, 31, 46, 0.8);
            border: 1px solid rgba(212, 175, 55, 0.2);
            border-radius: 4px;
            padding: 6px 8px;
            color: var(--text-primary);
            font-size: 14px;
        }
        .add-loan-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            padding: 10px;
            background: rgba(26, 31, 46, 0.6);
            border: 1px dashed rgba(212, 175, 55, 0.4);
            border-radius: 8px;
            color: var(--gold-accent);
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }
        .add-loan-btn:hover {
            background: rgba(212, 175, 55, 0.1);
            border-style: solid;
        }
        
        /* Strategy Details Modal */
        .strategy-details-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        .strategy-details-modal.active {
            opacity: 1;
            visibility: visible;
        }
        .strategy-details-content {
            background: var(--secondary-dark);
            border: 1px solid rgba(212, 175, 55, 0.3);
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            padding: 24px;
            position: relative;
        }
        .strategy-details-close {
            position: absolute;
            top: 16px;
            right: 16px;
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 24px;
            transition: color 0.2s;
        }
        .strategy-details-close:hover {
            color: var(--text-primary);
        }
        .strategy-details-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 16px;
            color: var(--gold-accent);
        }
        .strategy-details-description {
            margin-bottom: 20px;
            color: var(--text-primary);
            line-height: 1.6;
        }
        .strategy-details-calculation {
            background: rgba(26, 31, 46, 0.6);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 20px;
        }
        .strategy-details-calculation h4 {
            font-size: 18px;
            margin-bottom: 12px;
            color: var(--gold-accent);
        }
        .strategy-details-calculation ul {
            list-style-type: none;
            padding-left: 0;
        }
        .strategy-details-calculation li {
            margin-bottom: 8px;
            padding-left: 20px;
            position: relative;
        }
        .strategy-details-calculation li:before {
            content: "â€¢";
            color: var(--gold-accent);
            position: absolute;
            left: 0;
        }
        .strategy-details-pros-cons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 20px;
        }
        .strategy-details-pros, .strategy-details-cons {
            background: rgba(26, 31, 46, 0.6);
            border-radius: 8px;
            padding: 16px;
        }
        .strategy-details-pros h4, .strategy-details-cons h4 {
            font-size: 18px;
            margin-bottom: 12px;
        }
        .strategy-details-pros h4 {
            color: var(--success-green);
        }
        .strategy-details-cons h4 {
            color: var(--danger-red);
        }
        .strategy-details-pros ul, .strategy-details-cons ul {
            list-style-type: none;
            padding-left: 0;
        }
        .strategy-details-pros li, .strategy-details-cons li {
            margin-bottom: 8px;
            padding-left: 20px;
            position: relative;
        }
        .strategy-details-pros li:before {
            content: "+";
            color: var(--success-green);
            position: absolute;
            left: 0;
        }
        .strategy-details-cons li:before {
            content: "-";
            color: var(--danger-red);
            position: absolute;
            left: 0;
        }
        .view-details-btn {
            position: absolute;
            bottom: 8px;
            right: 8px;
            background: rgba(212, 175, 55, 0.2);
            color: var(--gold-accent);
            border: none;
            border-radius: 4px;
            padding: 4px 8px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }
        .view-details-btn:hover {
            background: rgba(212, 175, 55, 0.4);
        }
        
        /* Celebration Animation */
        @keyframes celebrate {
            0% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.2) rotate(180deg); }
            100% { transform: scale(1) rotate(360deg); }
        }
        .celebration {
            animation: celebrate 2s ease-in-out;
        }
        
        /* Debt-Free Countdown */
        .countdown-container {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(16, 185, 129, 0.2));
            border: 2px solid rgba(16, 185, 129, 0.3);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }
        .countdown-title {
            font-size: 1.25rem;
            font-weight: bold;
            color: var(--success-green);
            margin-bottom: 16px;
        }
        .countdown-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
        }
        .countdown-item {
            background: rgba(26, 31, 46, 0.6);
            border-radius: 8px;
            padding: 12px;
        }
        .countdown-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--success-green);
        }
        .countdown-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }
    </style>
</head>
<body class="mobile-optimized">
    <div class="container mx-auto p-4 md:p-8">
        <header class="flex flex-col md:flex-row justify-between items-center mb-8 fade-in-up">
            <div class="text-center md:text-left mb-4 md:mb-0">
                <h1 class="text-4xl md:text-5xl font-extrabold text-transparent bg-clip-text gold-gradient tracking-tight">
                    The True Cost Calculator
                </h1>
                <p class="mt-2 text-lg text-gray-400">Exclusive Financial Intelligence for the Discerning Investor</p>
            </div>
            <div class="flex items-center space-x-4">
                <span class="exclusive-badge">PREMIUM ACCESS</span>
            </div>
        </header>
        
        <!-- Tabs -->
        <div class="mb-8 flex flex-wrap justify-center border-b border-gray-700">
            <button data-tab="calculator" class="tab-button tab-active text-sm md:text-base font-medium p-4 border-b-2 border-transparent">Purchase Calculator</button>
            <button data-tab="debt" class="tab-button text-sm md:text-base font-medium p-4 border-b-2 border-transparent">Debt Impact</button>
            <button data-tab="investment" class="tab-button text-sm md:text-base font-medium p-4 border-b-2 border-transparent">Investment Builder</button>
            <button data-tab="motive" class="tab-button text-sm md:text-base font-medium p-4 border-b-2 border-transparent">My Money Motive</button>
            <button data-tab="goals" class="tab-button text-sm md:text-base font-medium p-4 border-b-2 border-transparent">Financial Goals</button>
            <button data-tab="retirement" class="tab-button text-sm md:text-base font-medium p-4 border-b-2 border-transparent">Retirement</button>
            <button data-tab="health" class="tab-button text-sm md:text-base font-medium p-4 border-b-2 border-transparent">Financial Health</button>
        </div>
        
        <main id="app-container">
            <!-- Purchase Calculator Tab -->
            <div id="calculator-content">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Input Section -->
                    <div class="lg:col-span-1 result-card p-6 rounded-xl h-fit space-y-4">
                        <div>
                            <h2 class="text-2xl font-bold mb-4">Your Details</h2>
                            <div class="space-y-4">
                                <div>
                                    <label for="age" class="block text-sm font-medium text-gray-300">Your Age</label>
                                    <input type="number" id="age" class="mt-1 block w-full px-3 py-2 premium-input rounded-md" placeholder="e.g., 30">
                                </div>
                                <div>
                                    <label for="gender" class="block text-sm font-medium text-gray-300">Gender</label>
                                    <select id="gender" class="mt-1 block w-full px-3 py-2 premium-input rounded-md">
                                        <option value="male">Male</option>
                                        <option value="female">Female</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <hr class="border-gray-700">
                        <div>
                            <h2 class="text-xl font-bold pt-2">Your Purchase</h2>
                             <div class="space-y-4 mt-4">
                                <div>
                                    <label for="itemName" class="block text-sm font-medium text-gray-300">Item Name</label>
                                    <input type="text" id="itemName" class="mt-1 block w-full px-3 py-2 premium-input rounded-md" placeholder="e.g., New Smartphone">
                                </div>
                                <div>
                                    <label for="itemCost" class="block text-sm font-medium text-gray-300">Cost (USD)</label>
                                    <input type="number" id="itemCost" class="mt-1 block w-full px-3 py-2 premium-input rounded-md" placeholder="e.g., 999">
                                </div>
                                <div>
                                    <label for="preTaxHourlyIncome" class="block text-sm font-medium text-gray-300">Pre-Tax Hourly Income</label>
                                    <input type="number" id="preTaxHourlyIncome" class="mt-1 block w-full px-3 py-2 premium-input rounded-md" placeholder="e.g., 35">
                                </div>
                                <div>
                                    <label for="paycheckFrequency" class="block text-sm font-medium text-gray-300">Paycheck Frequency</label>
                                    <select id="paycheckFrequency" class="mt-1 block w-full px-3 py-2 premium-input rounded-md">
                                        <option value="weekly">Weekly</option>
                                        <option value="biweekly" selected>Bi-Weekly</option>
                                        <option value="monthly">Monthly</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="location" class="block text-sm font-medium text-gray-300">Your State</label>
                                    <select id="location" class="mt-1 block w-full px-3 py-2 premium-input rounded-md">
                                        <option value="CA">California</option>
                                        <option value="OR" selected>Oregon</option>
                                        <option value="WA">Washington</option>
                                        <option value="TX">Texas</option>
                                        <option value="FL">Florida</option>
                                        <option value="NY">New York</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                         <hr class="border-gray-700">
                        <div>
                            <h2 class="text-xl font-bold pt-2">Financial Snapshot (Optional)</h2>
                            <div class="space-y-4 mt-4">
                                <div>
                                    <label for="currentSavings" class="block text-sm font-medium text-gray-300">Emergency Savings</label>
                                    <input type="number" id="currentSavings" class="mt-1 block w-full px-3 py-2 premium-input rounded-md" placeholder="e.g., 10000">
                                </div>
                                <div>
                                    <label for="monthlyExpenses" class="block text-sm font-medium text-gray-300">Monthly Expenses</label>
                                    <input type="number" id="monthlyExpenses" class="mt-1 block w-full px-3 py-2 premium-input rounded-md" placeholder="e.g., 3000">
                                </div>
                                <div>
                                    <label for="debtAmount" class="block text-sm font-medium text-gray-300">Total Debt</label>
                                    <input type="number" id="debtAmount" class="mt-1 block w-full px-3 py-2 premium-input rounded-md" placeholder="e.g., 5000">
                                </div>
                                <div>
                                    <label for="debtInterestRate" class="block text-sm font-medium text-gray-300">Debt Interest Rate (%)</label>
                                    <input type="number" id="debtInterestRate" class="mt-1 block w-full px-3 py-2 premium-input rounded-md" placeholder="e.g., 18">
                                </div>
                            </div>
                        </div>
                        <button id="calculateBtn" class="w-full premium-button py-3 px-4 rounded-lg">Calculate True Cost</button>
                    </div>
                    <!-- Results Section -->
                    <div id="results-section" class="lg:col-span-2 space-y-6 hidden">
                        <div class="text-center p-4 result-card rounded-lg">
                             <h2 class="text-3xl font-bold">The True Cost of a <span id="resultItemName" class="text-transparent bg-clip-text gold-gradient"></span></h2>
                             <p class="text-gray-400">Total Cost: <span id="totalCostWithTax" class="font-semibold"></span></p>
                             <p class="text-gray-400 mt-1">Your estimated net hourly wage: <span id="netIncomeDisplay" class="font-semibold"></span></p>
                        </div>
                        <div id="calculator-fact" class="result-card p-4 rounded-xl text-center bg-gradient-to-r from-yellow-900/20 to-yellow-800/20 border border-yellow-700/30"></div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Time Cost -->
                            <div class="result-card p-6 rounded-xl">
                                <div class="flex items-center mb-3">
                                    <i data-lucide="clock" class="w-8 h-8 text-yellow-500 mr-3"></i>
                                    <h3 class="text-xl font-bold">Time Cost</h3>
                                    <div class="tooltip ml-2">
                                        <i data-lucide="info" class="w-4 h-4 text-gray-400"></i>
                                        <span class="tooltiptext">This shows how many hours you need to work to afford this purchase after taxes.</span>
                                    </div>
                                </div>
                                <p class="text-gray-400">This purchase will cost you</p>
                                <p class="text-3xl font-bold text-yellow-500 my-2"><span id="hoursWorked">0</span> hours</p>
                                <p class="text-gray-400">(<span id="daysWorked">0</span> waking days)</p>
                            </div>
                            <!-- Paycheck Power -->
                            <div class="result-card p-6 rounded-xl">
                                <div class="flex items-center mb-3">
                                    <i data-lucide="receipt" class="w-8 h-8 text-orange-500 mr-3"></i>
                                    <h3 class="text-xl font-bold">Paycheck Power</h3>
                                    <div class="tooltip ml-2">
                                        <i data-lucide="info" class="w-4 h-4 text-gray-400"></i>
                                        <span class="tooltiptext">This shows what percentage of your paycheck this purchase represents.</span>
                                    </div>
                                </div>
                                <p class="text-gray-400">This purchase is equal to</p>
                                <p class="text-3xl font-bold text-orange-600 my-2"><span id="paycheckPercentage">0</span>%</p>
                                <p class="text-gray-400">of one net paycheck.</p>
                            </div>
                             <!-- Freedom Fund -->
                            <div id="freedom-fund-card" class="result-card p-6 rounded-xl hidden">
                                <div class="flex items-center mb-3">
                                    <i data-lucide="shield-half" class="w-8 h-8 text-sky-500 mr-3"></i>
                                    <h3 class="text-xl font-bold">Freedom Fund</h3>
                                    <div class="tooltip ml-2">
                                        <i data-lucide="info" class="w-4 h-4 text-gray-400"></i>
                                        <span class="tooltiptext">This shows how much additional financial security this money could provide.</span>
                                    </div>
                                </div>
                                <p class="text-gray-400">Your current runway is <strong id="runwayMonths" class="text-sky-400"></strong> months. Saving this adds</p>
                                <p class="text-3xl font-bold text-sky-500 my-2">+<span id="runwayAdded">0</span> days</p>
                                <p class="text-gray-400">to your financial safety net.</p>
                            </div>
                            <!-- Lifetime Perspective -->
                            <div class="result-card p-6 rounded-xl md:col-span-2">
                                <div class="flex items-center mb-3">
                                    <i data-lucide="user-check" class="w-8 h-8 text-teal-500 mr-3"></i>
                                    <h3 class="text-xl font-bold">Lifetime Perspective</h3>
                                    <div class="tooltip ml-2">
                                        <i data-lucide="info" class="w-4 h-4 text-gray-400"></i>
                                        <span class="tooltiptext">This shows what portion of your remaining waking years this purchase represents.</span>
                                    </div>
                                </div>
                                <p class="text-gray-400">You have approx. <strong id="hoursLeft" class="text-teal-400"></strong> waking hours left in your healthy life.</p>
                                <p class="text-gray-400 mt-2">This purchase consumes <strong id="lifePercentage" class="text-teal-400"></strong> of one of those precious years.</p>
                            </div>
                            <!-- Opportunity Cost -->
                            <div class="result-card p-6 rounded-xl md:col-span-2">
                                <div class="flex items-center mb-3">
                                    <i data-lucide="trending-up" class="w-8 h-8 text-green-500 mr-3"></i>
                                    <h3 class="text-xl font-bold">Future Value Projection</h3>
                                    <div class="tooltip ml-2">
                                        <i data-lucide="info" class="w-4 h-4 text-gray-400"></i>
                                        <span class="tooltiptext">This shows how much this money could grow if invested instead of spent.</span>
                                    </div>
                                </div>
                                <p class="text-gray-400 mb-4">If invested, this money could grow significantly over 20 years:</p>
                                <div class="chart-container">
                                    <canvas id="futureValueChart"></canvas>
                                </div>
                                <p class="text-xs text-center mt-2 text-gray-500">Based on updated long-term avg. annual returns: S&P 500 (10%), BTC (15% speculative), Gold (5%). Not financial advice.</p>
                            </div>
                            <!-- Debt Impact -->
                            <div id="debt-impact-card" class="result-card p-6 rounded-xl md:col-span-2 hidden">
                                <div class="flex items-center mb-3">
                                    <i data-lucide="credit-card" class="w-8 h-8 text-red-500 mr-3"></i>
                                    <h3 class="text-xl font-bold">Debt Impact</h3>
                                    <div class="tooltip ml-2">
                                        <i data-lucide="info" class="w-4 h-4 text-gray-400"></i>
                                        <span class="tooltiptext">This shows how much you could save by using this money to pay down debt instead.</span>
                                    </div>
                                </div>
                                <p class="text-gray-400">Using this money to pay down debt would save you</p>
                                <p class="text-3xl font-bold text-red-600 my-2"><span id="debtInterestSaved">0</span></p>
                                <p class="text-gray-400">in interest payments and reduce your debt payoff time by <span id="debtTimeSaved" class="font-semibold">0</span> months.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Enhanced Debt Impact Tab -->
            <div id="debt-content" class="hidden max-w-7xl mx-auto">
                <!-- Debt Input Section -->
                <div class="result-card p-6 rounded-xl mb-6">
                    <h2 class="text-2xl font-bold mb-4">Debt Impact Calculator</h2>
                    <p class="text-gray-400 mb-6">Analyze your debt payoff journey with visual timelines, multiple strategies, and comprehensive insights.</p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                        <div>
                            <label for="monthlyIncome" class="block text-sm font-medium text-gray-300">Monthly Income</label>
                            <input type="number" id="monthlyIncome" class="mt-1 block w-full px-3 py-2 premium-input rounded-md" placeholder="e.g., 5000">
                        </div>
                        <div>
                            <label for="creditScore" class="block text-sm font-medium text-gray-300">Current Credit Score</label>
                            <input type="number" id="creditScore" class="mt-1 block w-full px-3 py-2 premium-input rounded-md" placeholder="e.g., 680">
                        </div>
                    </div>
                    
                    <div>
                        <h3 class="text-lg font-bold mb-3">Your Debts</h3>
                        <div id="loans-container">
                            <!-- Individual loans will be added here -->
                        </div>
                        <div class="add-loan-btn" id="add-loan-btn">
                            <i data-lucide="plus" class="w-4 h-4 mr-2"></i> Add Another Loan
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-6">
                        <div>
                            <label for="debtExtra" class="block text-sm font-medium text-gray-300">Extra Monthly Payment (from purchase)</label>
                            <input type="number" id="debtExtra" class="mt-1 block w-full px-3 py-2 premium-input rounded-md" placeholder="e.g., 500">
                        </div>
                        <div>
                            <label for="totalMonthlyPayment" class="block text-sm font-medium text-gray-300">Total Monthly Payment</label>
                            <input type="number" id="totalMonthlyPayment" class="mt-1 block w-full px-3 py-2 premium-input rounded-md" placeholder="e.g., 1000">
                        </div>
                    </div>
                    
                    <button id="debtBtn" class="w-full premium-button py-3 px-4 rounded-lg mt-6">Analyze Debt Impact</button>
                </div>
                
                <!-- Debt Results Section -->
                <div id="debt-results" class="hidden space-y-6">
                    <!-- Visual Timeline Section -->
                    <div class="result-card p-6 rounded-xl">
                        <h3 class="text-xl font-bold mb-4">Debt Payoff Timeline</h3>
                        <div class="debt-timeline" id="debtTimeline">
                            <div class="timeline-track"></div>
                            <div class="timeline-progress" id="timelineProgress" style="width: 0%"></div>
                            <!-- Milestones will be added dynamically -->
                        </div>
                        <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="countdown-container">
                                <div class="countdown-title">ðŸŽ‰ Debt-Free Countdown</div>
                                <div class="countdown-grid">
                                    <div class="countdown-item">
                                        <div id="countdownMonths" class="countdown-value">0</div>
                                        <div class="countdown-label">Months</div>
                                    </div>
                                    <div class="countdown-item">
                                        <div id="countdownDays" class="countdown-value">0</div>
                                        <div class="countdown-label">Days</div>
                                    </div>
                                    <div class="countdown-item">
                                        <div id="countdownHours" class="countdown-value">0</div>
                                        <div class="countdown-label">Hours</div>
                                    </div>
                                </div>
                            </div>
                            <div class="result-card p-4 rounded-xl">
                                <h4 class="text-lg font-bold mb-2">Debt Freedom Date</h4>
                                <p id="debtFreeDate" class="text-2xl font-bold text-green-500">--</p>
                                <p class="text-sm text-gray-400 mt-2">You'll be debt-free on this date with your current plan!</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Multiple Strategy Comparison -->
                    <div class="result-card p-6 rounded-xl">
                        <h3 class="text-xl font-bold mb-4">Debt Payoff Strategies</h3>
                        <p class="text-gray-400 mb-6">Compare different debt payoff methods to find the best strategy for you.</p>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                            <div class="strategy-card" data-strategy="current">
                                <h4 class="font-bold mb-2">Current Plan</h4>
                                <p class="text-sm text-gray-400 mb-2">Your existing payment schedule</p>
                                <div class="space-y-1">
                                    <p class="text-xs">Time: <span class="strategy-time font-semibold">0</span> months</p>
                                    <p class="text-xs">Interest: <span class="strategy-interest font-semibold">$0</span></p>
                                </div>
                                <button class="view-details-btn" data-strategy="current">View Details</button>
                            </div>
                            <div class="strategy-card" data-strategy="avalanche">
                                <h4 class="font-bold mb-2">Debt Avalanche</h4>
                                <p class="text-sm text-gray-400 mb-2">Highest interest rate first</p>
                                <div class="space-y-1">
                                    <p class="text-xs">Time: <span class="strategy-time font-semibold">0</span> months</p>
                                    <p class="text-xs">Interest: <span class="strategy-interest font-semibold">$0</span></p>
                                </div>
                                <button class="view-details-btn" data-strategy="avalanche">View Details</button>
                            </div>
                            <div class="strategy-card" data-strategy="snowball">
                                <h4 class="font-bold mb-2">Debt Snowball</h4>
                                <p class="text-sm text-gray-400 mb-2">Smallest balance first</p>
                                <div class="space-y-1">
                                    <p class="text-xs">Time: <span class="strategy-time font-semibold">0</span> months</p>
                                    <p class="text-xs">Interest: <span class="strategy-interest font-semibold">$0</span></p>
                                </div>
                                <button class="view-details-btn" data-strategy="snowball">View Details</button>
                            </div>
                            <div class="strategy-card" data-strategy="consolidation">
                                <h4 class="font-bold mb-2">Consolidation</h4>
                                <p class="text-sm text-gray-400 mb-2">Lower rate loan</p>
                                <div class="space-y-1">
                                    <p class="text-xs">Time: <span class="strategy-time font-semibold">0</span> months</p>
                                    <p class="text-xs">Interest: <span class="strategy-interest font-semibold">$0</span></p>
                                </div>
                                <button class="view-details-btn" data-strategy="consolidation">View Details</button>
                            </div>
                        </div>
                        
                        <div id="strategyRecommendation" class="hidden p-4 rounded-lg bg-gradient-to-r from-green-900/20 to-green-800/20 border border-green-700/30">
                            <h4 class="font-bold text-green-500 mb-2">ðŸ’¡ Recommended Strategy</h4>
                            <p id="recommendationText" class="text-sm"></p>
                        </div>
                    </div>
                    
                    <!-- Comprehensive Analysis Dashboard -->
                    <div class="result-card p-6 rounded-xl">
                        <h3 class="text-xl font-bold mb-4">Comprehensive Debt Analysis</h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
                            <div class="metric-card">
                                <i data-lucide="trending-down" class="w-8 h-8 text-yellow-500 mx-auto mb-2"></i>
                                <div class="metric-label">
                                    Debt-to-Income Ratio
                                    <div class="metric-info-btn">
                                        <i data-lucide="info" class="w-3 h-3"></i>
                                        <div class="metric-tooltip">
                                            The percentage of your monthly income that goes toward debt payments. Lenders typically prefer this to be below 36%. Lower ratios indicate better financial health.
                                        </div>
                                    </div>
                                </div>
                                <div id="debtToIncomeRatio" class="metric-value">0%</div>
                                <div class="metric-change">Industry standard: < 36%</div>
                            </div>
                            <div class="metric-card">
                                <i data-lucide="percent" class="w-8 h-8 text-red-500 mx-auto mb-2"></i>
                                <div class="metric-label">
                                    Interest vs Principal
                                    <div class="metric-info-btn">
                                        <i data-lucide="info" class="w-3 h-3"></i>
                                        <div class="metric-tooltip">
                                            The percentage of your payments that goes toward interest rather than reducing your principal balance. Lower percentages mean more of your money is actually reducing your debt.
                                        </div>
                                    </div>
                                </div>
                                <div id="interestVsPrincipal" class="metric-value">0%</div>
                                <div class="metric-change negative">Interest: <span id="totalInterestAmount">$0</span></div>
                            </div>
                            <div class="metric-card">
                                <i data-lucide="award" class="w-8 h-8 text-green-500 mx-auto mb-2"></i>
                                <div class="metric-label">
                                    Credit Score Impact
                                    <div class="metric-info-btn">
                                        <i data-lucide="info" class="w-3 h-3"></i>
                                        <div class="metric-tooltip">
                                            The estimated improvement to your credit score from paying down your debt. Higher credit scores can lead to better interest rates on future loans and credit cards.
                                        </div>
                                    </div>
                                </div>
                                <div id="creditScoreImpact" class="metric-value">+0</div>
                                <div class="metric-change positive">Estimated improvement</div>
                            </div>
                            <div class="metric-card">
                                <i data-lucide="calendar" class="w-8 h-8 text-blue-500 mx-auto mb-2"></i>
                                <div class="metric-label">
                                    Debt Freedom Date
                                    <div class="metric-info-btn">
                                        <i data-lucide="info" class="w-3 h-3"></i>
                                        <div class="metric-tooltip">
                                            The date when you'll be completely debt-free based on your current payment plan. This can motivate you to stick to your payoff strategy.
                                        </div>
                                    </div>
                                </div>
                                <div id="freedomDateMetric" class="metric-value">--</div>
                                <div class="metric-change">Months remaining: <span id="monthsRemaining">0</span></div>
                            </div>
                            <div class="metric-card">
                                <i data-lucide="dollar-sign" class="w-8 h-8 text-purple-500 mx-auto mb-2"></i>
                                <div class="metric-label">
                                    Opportunity Cost
                                    <div class="metric-info-btn">
                                        <i data-lucide="info" class="w-3 h-3"></i>
                                        <div class="metric-tooltip">
                                            The potential growth your money could achieve if invested instead of used for debt payments. This helps you understand the true cost of your debt.
                                        </div>
                                    </div>
                                </div>
                                <div id="opportunityCost" class="metric-value">$0</div>
                                <div class="metric-change negative">If invested instead</div>
                            </div>
                            <div class="metric-card">
                                <i data-lucide="trending-up" class="w-8 h-8 text-green-500 mx-auto mb-2"></i>
                                <div class="metric-label">
                                    Monthly Cash Flow
                                    <div class="metric-info-btn">
                                        <i data-lucide="info" class="w-3 h-3"></i>
                                        <div class="metric-tooltip">
                                            The additional monthly income you'll have available once your debt is paid off. This money can be redirected toward savings, investments, or other financial goals.
                                        </div>
                                    </div>
                                </div>
                                <div id="cashFlowImprovement" class="metric-value">+$0</div>
                                <div class="metric-change positive">When debt-free</div>
                            </div>
                        </div>
                        
                        <!-- Interest vs Principal Chart -->
                        <div class="chart-container mb-6">
                            <canvas id="interestPrincipalChart" height="200"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Strategy Details Modal -->
            <div id="strategy-details-modal" class="strategy-details-modal">
                <div class="strategy-details-content">
                    <button class="strategy-details-close">&times;</button>
                    <h3 id="strategy-details-title" class="strategy-details-title"></h3>
                    <p id="strategy-details-description" class="strategy-details-description"></p>
                    
                    <div class="strategy-details-calculation">
                        <h4>How It Works</h4>
                        <ul id="strategy-details-calculation-steps"></ul>
                    </div>
                    
                    <div class="strategy-details-pros-cons">
                        <div class="strategy-details-pros">
                            <h4>Pros</h4>
                            <ul id="strategy-details-pros-list"></ul>
                        </div>
                        <div class="strategy-details-cons">
                            <h4>Cons</h4>
                            <ul id="strategy-details-cons-list"></ul>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Investment Builder Tab -->
            <div id="investment-content" class="hidden max-w-7xl mx-auto">
                <div class="result-card p-6 rounded-xl mb-6">
                    <div class="flex justify-between items-center mb-4">
                        <div>
                            <h2 class="text-2xl font-bold">Investment Scenario Builder</h2>
                            <p class="text-gray-400">Premium portfolio analysis for sophisticated investors</p>
                        </div>
                        <span class="exclusive-badge">PRO FEATURE</span>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <!-- Scenario Inputs -->
                        <div class="lg:col-span-1">
                            <h3 class="text-xl font-bold mb-4">Scenario Parameters</h3>
                            
                            <div class="space-y-4 mb-6">
                                <div>
                                    <label for="initialInvestment" class="block text-sm font-medium text-gray-300">Initial Investment</label>
                                    <input type="number" id="initialInvestment" class="mt-1 block w-full px-3 py-2 premium-input rounded-md" placeholder="e.g., 1000">
                                </div>
                                
                                <div>
                                    <label for="monthlyContribution" class="block text-sm font-medium text-gray-300">Monthly Contribution</label>
                                    <input type="number" id="monthlyContribution" class="mt-1 block w-full px-3 py-2 premium-input rounded-md" placeholder="e.g., 100">
                                </div>
                                
                                <div>
                                    <label for="timeHorizon" class="block text-sm font-medium text-gray-300">Time Horizon (years)</label>
                                    <input type="range" id="timeHorizon" min="1" max="40" value="20" class="mt-1 block w-full">
                                    <div class="flex justify-between text-sm text-gray-500">
                                        <span>1 year</span>
                                        <span id="timeHorizonValue" class="font-medium text-gray-300">20 years</span>
                                        <span>40 years</span>
                                    </div>
                                </div>
                                <!-- Inflation Adjustment -->
                                <div>
                                    <label for="inflationRate" class="block text-sm font-medium text-gray-300">Inflation Rate (%)</label>
                                    <input type="number" id="inflationRate" value="3.3" step="0.1" class="mt-1 block w-full px-3 py-2 premium-input rounded-md">
                                    <p class="text-xs text-gray-500 mt-1">Historical average: 3.3%</p>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <input type="checkbox" id="showRealReturns" class="w-4 h-4 text-yellow-500">
                                    <label for="showRealReturns" class="text-sm font-medium text-gray-300">Show Real (Inflation-Adjusted) Returns</label>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Asset Allocation</label>
                                    
                                    <div class="mb-3">
                                        <div class="asset-allocation">
                                            <div class="asset-color" style="background-color: #4f46e5;"></div>
                                            <div class="asset-info">
                                                <div class="asset-name">Stocks</div>
                                                <div class="asset-return">Est. Annual Return: 8.0%</div>
                                            </div>
                                            <div class="asset-value" id="stocksValue">60%</div>
                                            <div class="edu-tooltip ml-2">
                                                <i data-lucide="help-circle" class="w-4 h-4 text-gray-400"></i>
                                                <div class="edu-tooltip-content">
                                                    <strong>Stocks (Equities)</strong><br>
                                                    Represent ownership in companies. Historically provide the highest long-term returns but with higher volatility. Includes large-cap, mid-cap, and small-cap stocks across various sectors.
                                                </div>
                                            </div>
                                        </div>
                                        <input type="range" id="stocksAllocation" min="0" max="100" value="60" class="mt-1 block w-full">
                                    </div>
                                    
                                    <div class="mb-3">
                                        <div class="asset-allocation">
                                            <div class="asset-color" style="background-color: #10b981;"></div>
                                            <div class="asset-info">
                                                <div class="asset-name">Bonds</div>
                                                <div class="asset-return">Est. Annual Return: 4.0%</div>
                                            </div>
                                            <div class="asset-value" id="bondsValue">20%</div>
                                            <div class="edu-tooltip ml-2">
                                                <i data-lucide="help-circle" class="w-4 h-4 text-gray-400"></i>
                                                <div class="edu-tooltip-content">
                                                    <strong>Bonds (Fixed Income)</strong><br>
                                                    Loans to governments or corporations that pay interest. Generally lower risk and returns than stocks, providing portfolio stability and income.
                                                </div>
                                            </div>
                                        </div>
                                        <input type="range" id="bondsAllocation" min="0" max="100" value="20" class="mt-1 block w-full">
                                    </div>
                                    
                                    <div class="mb-3">
                                        <div class="asset-allocation">
                                            <div class="asset-color" style="background-color: #f59e0b;"></div>
                                            <div class="asset-info">
                                                <div class="asset-name">Gold</div>
                                                <div class="asset-return">Est. Annual Return: 7.5%</div>
                                            </div>
                                            <div class="asset-value" id="goldValue">5%</div>
                                            <div class="edu-tooltip ml-2">
                                                <i data-lucide="help-circle" class="w-4 h-4 text-gray-400"></i>
                                                <div class="edu-tooltip-content">
                                                    <strong>Gold (Precious Metals)</strong><br>
                                                    Traditional safe-haven asset that tends to perform well during economic uncertainty and inflation. Acts as a portfolio diversifier.
                                                </div>
                                            </div>
                                        </div>
                                        <input type="range" id="goldAllocation" min="0" max="100" value="5" class="mt-1 block w-full">
                                    </div>
                                    
                                    <div class="mb-3">
                                        <div class="asset-allocation">
                                            <div class="asset-color" style="background-color: #f97316;"></div>
                                            <div class="asset-info">
                                                <div class="asset-name">Bitcoin</div>
                                                <div class="asset-return">Est. Annual Return: 15.0%</div>
                                            </div>
                                            <div class="asset-value" id="btcValue">5%</div>
                                            <div class="edu-tooltip ml-2">
                                                <i data-lucide="help-circle" class="w-4 h-4 text-gray-400"></i>
                                                <div class="edu-tooltip-content">
                                                    <strong>Bitcoin (Cryptocurrency)</strong><br>
                                                    Digital asset with high growth potential but extreme volatility. Considered a speculative investment suitable for risk-tolerant investors.
                                                </div>
                                            </div>
                                        </div>
                                        <input type="range" id="btcAllocation" min="0" max="100" value="5" class="mt-1 block w-full">
                                    </div>
                                    
                                    <div class="mb-3">
                                        <div class="asset-allocation">
                                            <div class="asset-color" style="background-color: #8b5cf6;"></div>
                                            <div class="asset-info">
                                                <div class="asset-name">Other (Real Estate, Commodities)</div>
                                                <div class="asset-return">Est. Annual Return: 6.0%</div>
                                            </div>
                                            <div class="asset-value" id="otherValue">10%</div>
                                            <div class="edu-tooltip ml-2">
                                                <i data-lucide="help-circle" class="w-4 h-4 text-gray-400"></i>
                                                <div class="edu-tooltip-content">
                                                    <strong>Alternative Assets</strong><br>
                                                    Includes real estate, commodities, and other alternative investments. Provides diversification benefits and inflation protection.
                                                </div>
                                            </div>
                                        </div>
                                        <input type="range" id="otherAllocation" min="0" max="100" value="10" class="mt-1 block w-full">
                                    </div>
                                </div>
                                
                                <!-- Recommended Allocation -->
                                <div class="p-4 bg-gradient-to-r from-yellow-900/20 to-yellow-800/20 rounded-lg border border-yellow-700/30">
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="text-sm font-medium text-gray-300">Recommended Allocation</span>
                                        <button id="applyRecommendedBtn" class="text-xs premium-button py-1 px-3 rounded">Apply</button>
                                    </div>
                                    <div id="recommendedAllocation" class="text-xs text-gray-400">
                                        Based on your profile, we recommend a balanced portfolio
                                    </div>
                                </div>
                                
                                <div class="p-4 bg-gradient-to-r from-blue-900/20 to-blue-800/20 rounded-lg border border-blue-700/30">
                                    <div class="flex justify-between">
                                        <span class="text-sm font-medium text-gray-300">Expected Annual Return</span>
                                        <span id="expectedReturn" class="text-lg font-bold text-yellow-500">7.0%</span>
                                    </div>
                                    <div class="mt-2 text-xs text-gray-500">
                                        Based on historical averages and conservative projections
                                    </div>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <button id="addScenarioBtn" class="premium-button py-2 px-4 rounded-lg flex items-center justify-center">
                                    <i data-lucide="plus" class="w-4 h-4 mr-2"></i> Add Scenario
                                </button>
                                <button id="resetScenariosBtn" class="bg-gray-700 text-gray-300 font-medium py-2 px-4 rounded-lg hover:bg-gray-600 transition flex items-center justify-center">
                                    <i data-lucide="refresh-cw" class="w-4 h-4 mr-2"></i> Reset
                                </button>
                            </div>
                        </div>
                        
                        <!-- Results -->
                        <div class="lg:col-span-2">
                            <h3 class="text-xl font-bold mb-4">Projection Results</h3>
                            
                            <!-- Chart Tabs -->
                            <div class="flex space-x-2 mb-4">
                                <button class="chart-tab active px-4 py-2 rounded-lg text-sm font-medium bg-gray-700 text-white" data-chart="growth">Growth Projection</button>
                                <button class="chart-tab px-4 py-2 rounded-lg text-sm font-medium bg-gray-800 text-gray-400" data-chart="allocation">Asset Allocation</button>
                                <button class="chart-tab px-4 py-2 rounded-lg text-sm font-medium bg-gray-800 text-gray-400" data-chart="waterfall">Contributions vs Growth</button>
                                <button class="chart-tab px-4 py-2 rounded-lg text-sm font-medium bg-gray-800 text-gray-400" data-chart="montecarlo">Monte Carlo</button>
                                <button class="chart-tab px-4 py-2 rounded-lg text-sm font-medium bg-gray-800 text-gray-400" data-chart="timeline">Time to Goal</button>
                            </div>
                            
                            <div class="mb-6">
                                <div class="chart-container">
                                    <canvas id="investmentChart" height="300"></canvas>
                                </div>
                            </div>
                            
                            <!-- Scenario Comparison Table -->
                            <div class="scenario-table mb-6">
                                <table class="w-full">
                                    <thead>
                                        <tr>
                                            <th>Scenario</th>
                                            <th>Final Value</th>
                                            <th>Contributions</th>
                                            <th>Interest</th>
                                            <th>CAGR</th>
                                            <th>Risk Score</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="scenarioTableBody">
                                        <!-- Populated by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                            
                            <!-- What If Analysis -->
                            <div class="result-card p-4 rounded-xl mb-6">
                                <h4 class="text-lg font-bold mb-4">What If Analysis</h4>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-300 mb-1">+1% Return</label>
                                        <div id="plusOnePercent" class="text-lg font-bold text-green-500">+$0</div>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-300 mb-1">+$50/Month</label>
                                        <div id="plusFiftyMonthly" class="text-lg font-bold text-green-500">+$0</div>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-300 mb-1">+5 Years</label>
                                        <div id="plusFiveYears" class="text-lg font-bold text-green-500">+$0</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Educational Content -->
                            <div class="result-card p-4 rounded-xl">
                                <h4 class="text-lg font-bold mb-4">Investment Principles</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <h5 class="font-medium text-yellow-500 mb-2">Diversification</h5>
                                        <p class="text-sm text-gray-400">Spreading investments across different asset classes reduces risk and smooths returns over time.</p>
                                    </div>
                                    <div>
                                        <h5 class="font-medium text-yellow-500 mb-2">Compound Interest</h5>
                                        <p class="text-sm text-gray-400">Earning returns on your returns creates exponential growth over long periods.</p>
                                    </div>
                                    <div>
                                        <h5 class="font-medium text-yellow-500 mb-2">Dollar-Cost Averaging</h5>
                                        <p class="text-sm text-gray-400">Regular investments reduce the impact of market volatility and timing risk.</p>
                                    </div>
                                    <div>
                                        <h5 class="font-medium text-yellow-500 mb-2">Risk vs Return</h5>
                                        <p class="text-sm text-gray-400">Higher potential returns typically come with higher risk and volatility.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Money Motive Tab -->
            <div id="motive-content" class="hidden max-w-2xl mx-auto">
                <div id="quiz-container" class="result-card p-8 rounded-xl">
                    <h2 class="text-3xl font-bold text-center mb-2">What's Your Money Motive?</h2>
                    <p class="text-center text-gray-400 mb-6">Discover the unconscious beliefs that drive your financial decisions.</p>
                    <div id="quiz-progress-bar" class="w-full bg-gray-700 rounded-full h-2.5 mb-6">
                        <div id="quiz-progress" class="bg-gradient-to-r from-yellow-500 to-yellow-600 h-2.5 rounded-full" style="width: 0%"></div>
                    </div>
                    <h3 id="quizQuestion" class="text-xl font-semibold text-center mb-6 h-12"></h3>
                    <div id="quizOptions" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Options will be populated by JS -->
                    </div>
                </div>
                <div id="motive-result-container" class="hidden result-card p-8 rounded-xl text-center">
                    <div id="archetypeIcon" class="mx-auto mb-4"></div>
                    <h2 id="archetypeTitle" class="text-3xl font-bold mb-2"></h2>
                    <div class="text-left space-y-4 mt-6">
                        <div>
                            <h4 class="font-bold text-lg">Core Motivation:</h4>
                            <p id="archetypeDescription" class="text-gray-400"></p>
                        </div>
                        <div>
                            <h4 class="font-bold text-lg">Potential Strengths:</h4>
                            <p id="archetypeStrengths" class="text-gray-400"></p>
                        </div>
                        <div>
                            <h4 class="font-bold text-lg">Potential Blind Spots:</h4>
                            <p id="archetypeBlinds" class="text-gray-400"></p>
                        </div>
                         <div>
                            <h4 class="font-bold text-lg">Mantra for Growth:</h4>
                            <p id="archetypeMantra" class="text-yellow-500 italic font-semibold"></p>
                        </div>
                    </div>
                    <button id="retakeQuizBtn" class="mt-8 premium-button py-2 px-4 rounded-lg">Retake Quiz</button>
                </div>
            </div>
            
            <!-- Financial Goals Tab -->
            <div id="goals-content" class="hidden max-w-2xl mx-auto space-y-6">
                <div id="goals-fact" class="result-card p-4 rounded-xl text-center bg-gradient-to-r from-yellow-900/20 to-yellow-800/20 border border-yellow-700/30 hidden"></div>
                <div class="result-card p-6 rounded-xl">
                    <h2 class="text-2xl font-bold mb-4">Set Your Financial Goal</h2>
                    <div class="space-y-4">
                        <div>
                            <label for="goalName" class="block text-sm font-medium text-gray-300">Goal Name</label>
                            <input type="text" id="goalName" class="mt-1 block w-full px-3 py-2 premium-input rounded-md" placeholder="e.g., Down Payment for House">
                        </div>
                        <div>
                            <label for="goalAmount" class="block text-sm font-medium text-gray-300">Goal Amount (USD)</label>
                            <input type="number" id="goalAmount" class="mt-1 block w-full px-3 py-2 premium-input rounded-md" placeholder="e.g., 40000">
                        </div>
                        <div>
                            <label for="currentGoalSavings" class="block text-sm font-medium text-gray-300">Current Savings for this Goal</label>
                            <input type="number" id="currentGoalSavings" class="mt-1 block w-full px-3 py-2 premium-input rounded-md" placeholder="e.g., 5000">
                        </div>
                        <button id="setGoalBtn" class="w-full premium-button py-3 px-4 rounded-lg">Set Goal & See Progress</button>
                    </div>
                </div>
                <div id="goal-tracker-section" class="mt-8 hidden">
                    <h3 class="text-2xl font-bold text-center">Progress Towards <span id="goalResultName" class="text-transparent bg-clip-text gold-gradient"></span></h3>
                    <div class="result-card p-6 rounded-lg mt-4">
                         <div class="chart-container max-w-xs mx-auto">
                            <canvas id="goalDonutChart"></canvas>
                         </div>
                         <p class="text-center mt-4 text-gray-400">Skipping the <strong id="goalItemName"></strong> would add <strong id="goalContribution" class="text-green-500"></strong> to your goal!</p>
                    </div>
                </div>
            </div>
            
            <!-- Retirement Tab -->
            <div id="retirement-content" class="hidden">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Retirement Inputs -->
                    <div class="lg:col-span-1 result-card p-6 rounded-xl h-fit">
                        <h2 class="text-2xl font-bold mb-4">Retirement Details</h2>
                        <div class="space-y-4">
                            <div>
                                <label for="retireAge" class="block text-sm font-medium text-gray-300">Current Age</label>
                                <input type="number" id="retireAge" class="mt-1 block w-full px-3 py-2 premium-input rounded-md" placeholder="e.g., 30">
                            </div>
                            <div>
                                <label for="annualIncome" class="block text-sm font-medium text-gray-300">Annual Pre-Tax Income</label>
                                <input type="number" id="annualIncome" class="mt-1 block w-full px-3 py-2 premium-input rounded-md" placeholder="e.g., 70000">
                            </div>
                            <div>
                                <label for="currentRetireSavings" class="block text-sm font-medium text-gray-300">Current Retirement Savings</label>
                                <input type="number" id="currentRetireSavings" class="mt-1 block w-full px-3 py-2 premium-input rounded-md" placeholder="e.g., 50000">
                            </div>
                            <div>
                                <label for="savingsRate" class="block text-sm font-medium text-gray-300">Annual Savings Rate (%)</label>
                                <input type="number" id="savingsRate" class="mt-1 block w-full px-3 py-2 premium-input rounded-md" placeholder="e.g., 15">
                            </div>
                             <div>
                                <label for="annualExpenses" class="block text-sm font-medium text-gray-300">Est. Annual Retirement Expenses</label>
                                <input type="number" id="annualExpenses" class="mt-1 block w-full px-3 py-2 premium-input rounded-md" placeholder="e.g., 40000">
                            </div>
                             <div>
                                <label for="retirementDream" class="block text-sm font-medium text-gray-300">My Retirement Dream Is...</label>
                                <input type="text" id="retirementDream" class="mt-1 block w-full px-3 py-2 premium-input rounded-md" placeholder="e.g., Traveling the world">
                            </div>
                            <button id="calculateRetireBtn" class="w-full premium-button py-3 px-4 rounded-lg">Calculate Retirement</button>
                        </div>
                    </div>
                    <!-- Retirement Results -->
                    <div id="retirement-results-section" class="lg:col-span-2 space-y-6 hidden">
                        <div id="retirement-fact" class="result-card p-4 rounded-xl text-center bg-gradient-to-r from-yellow-900/20 to-yellow-800/20 border border-yellow-700/30"></div>
                        <div class="result-card p-6 rounded-xl text-center">
                            <h3 class="text-xl font-bold">Your Retirement Goal</h3>
                            <p class="text-2xl text-transparent bg-clip-text gold-gradient my-2">"<span id="dreamDisplay"></span>"</p>
                            <p class="text-gray-400">You can achieve this at age <strong id="retirementAgeResult" class="text-transparent bg-clip-text gold-gradient text-3xl">0</strong></p>
                        </div>
                         <div class="result-card p-6 rounded-xl text-center">
                            <h3 class="text-xl font-bold text-center mb-4">Retirement Snapshot</h3>
                            <p class="text-gray-400 mt-2">FI Number: <strong id="fiNumberResult" class="text-white"></strong></p>
                            <p class="text-gray-400">4% Withdrawal: <strong id="withdrawalResult" class="text-white"></strong>/yr</p>
                            <p class="text-xs text-gray-500 mt-1">Your portfolio is designed to last for a <strong class="font-semibold">30-year retirement</strong>.</p>
                        </div>
                        <div class="result-card p-6 rounded-xl text-center">
                            <h3 class="text-xl font-bold text-center mb-4">The Impact of This Purchase</h3>
                            <p class="text-center text-gray-400 mb-4">Investing the <strong id="retireItemName" class="text-green-500"></strong> instead of spending it could buy you more time in retirement.</p>
                            <div id="purchaseImpactResult" class="p-4 rounded-lg bg-gradient-to-r from-green-900/20 to-green-800/20 text-center">
                                <!-- Content generated by JS -->
                            </div>
                        </div>
                        <div class="result-card p-6 rounded-xl">
                            <h3 class="text-xl font-bold text-center mb-4">What Your Extra Retirement Time Means</h3>
                            <div id="retirementMeaning" class="text-center text-gray-300"></div>
                        </div>
                        <div class="result-card p-6 rounded-xl">
                            <h3 class="text-xl font-bold text-center mb-4">Your Life's Timeline</h3>
                            <p class="text-center text-gray-400 mb-4">Based on your current path, here is the breakdown of your life's waking hours.</p>
                            <div id="timeValueTable" class="space-y-4"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Financial Health Tab -->
            <div id="health-content" class="hidden max-w-4xl mx-auto">
                <div class="result-card p-6 rounded-xl mb-6">
                    <h2 class="text-2xl font-bold mb-4">Financial Health Dashboard</h2>
                    <p class="text-gray-400 mb-6">Get a comprehensive view of your financial health and personalized recommendations.</p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <label for="healthIncome" class="block text-sm font-medium text-gray-300">Monthly Income</label>
                            <input type="number" id="healthIncome" class="mt-1 block w-full px-3 py-2 premium-input rounded-md" placeholder="e.g., 5000">
                        </div>
                        <div>
                            <label for="healthExpenses" class="block text-sm font-medium text-gray-300">Monthly Expenses</label>
                            <input type="number" id="healthExpenses" class="mt-1 block w-full px-3 py-2 premium-input rounded-md" placeholder="e.g., 3500">
                        </div>
                        <div>
                            <label for="healthSavings" class="block text-sm font-medium text-gray-300">Emergency Savings</label>
                            <input type="number" id="healthSavings" class="mt-1 block w-full px-3 py-2 premium-input rounded-md" placeholder="e.g., 10000">
                        </div>
                        <div>
                            <label for="healthDebt" class="block text-sm font-medium text-gray-300">Total Debt</label>
                            <input type="number" id="healthDebt" class="mt-1 block w-full px-3 py-2 premium-input rounded-md" placeholder="e.g., 15000">
                        </div>
                    </div>
                    
                    <button id="healthBtn" class="w-full premium-button py-3 px-4 rounded-lg">Calculate Financial Health</button>
                </div>
                
                <div id="health-results" class="hidden">
                    <div class="text-center mb-6">
                        <h3 class="text-2xl font-bold mb-2">Your Financial Health Score</h3>
                        <div class="flex justify-center mb-4">
                            <div class="health-score" id="healthScoreCircle">
                                <div class="health-score-text" id="healthScoreText">0</div>
                            </div>
                        </div>
                        <p id="healthScoreDescription" class="text-lg text-gray-400"></p>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div class="result-card p-6 rounded-xl">
                            <h4 class="text-lg font-bold mb-4">Financial Metrics</h4>
                            <div class="space-y-3">
                                <div>
                                    <p class="text-gray-400">Savings Rate</p>
                                    <div class="w-full bg-gray-700 rounded-full h-2.5">
                                        <div id="savingsRateBar" class="bg-gradient-to-r from-yellow-500 to-yellow-600 h-2.5 rounded-full" style="width: 0%"></div>
                                    </div>
                                    <p class="text-right text-sm text-gray-500 mt-1"><span id="savingsRateValue">0</span>%</p>
                                </div>
                                <div>
                                    <p class="text-gray-400">Debt-to-Income Ratio</p>
                                    <div class="w-full bg-gray-700 rounded-full h-2.5">
                                        <div id="debtRatioBar" class="bg-gradient-to-r from-yellow-500 to-yellow-600 h-2.5 rounded-full" style="width: 0%"></div>
                                    </div>
                                    <p class="text-right text-sm text-gray-500 mt-1"><span id="debtRatioValue">0</span>%</p>
                                </div>
                                <div>
                                    <p class="text-gray-400">Emergency Fund Coverage</p>
                                    <div class="w-full bg-gray-700 rounded-full h-2.5">
                                        <div id="emergencyFundBar" class="bg-gradient-to-r from-yellow-500 to-yellow-600 h-2.5 rounded-full" style="width: 0%"></div>
                                    </div>
                                    <p class="text-right text-sm text-gray-500 mt-1"><span id="emergencyFundValue">0</span> months</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="result-card p-6 rounded-xl">
                            <h4 class="text-lg font-bold mb-4">Personalized Recommendations</h4>
                            <div id="healthRecommendations" class="space-y-3">
                                <!-- Recommendations will be populated by JS -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="result-card p-6 rounded-xl">
                        <h4 class="text-lg font-bold mb-4">Financial Milestones</h4>
                        <div class="space-y-4">
                            <div class="flex items-center">
                                <div class="flex-shrink-0 w-10 h-10 rounded-full bg-yellow-900/20 flex items-center justify-center">
                                    <i data-lucide="check" class="w-5 h-5 text-yellow-500"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-white">Establish Emergency Fund</p>
                                    <p class="text-sm text-gray-500">3-6 months of expenses</p>
                                </div>
                                <div class="ml-auto">
                                    <span id="emergencyFundStatus" class="px-2 py-1 text-xs rounded-full bg-gray-700 text-gray-300">Not Started</span>
                                </div>
                            </div>
                            <div class="flex items-center">
                                <div class="flex-shrink-0 w-10 h-10 rounded-full bg-yellow-900/20 flex items-center justify-center">
                                    <i data-lucide="check" class="w-5 h-5 text-yellow-500"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-white">Pay Off High-Interest Debt</p>
                                    <p class="text-sm text-gray-500">Debt with interest > 10%</p>
                                </div>
                                <div class="ml-auto">
                                    <span id="debtStatus" class="px-2 py-1 text-xs rounded-full bg-gray-700 text-gray-300">Not Started</span>
                                </div>
                            </div>
                            <div class="flex items-center">
                                <div class="flex-shrink-0 w-10 h-10 rounded-full bg-yellow-900/20 flex items-center justify-center">
                                    <i data-lucide="check" class="w-5 h-5 text-yellow-500"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-white">Save for Retirement</p>
                                    <p class="text-sm text-gray-500">15% of income recommended</p>
                                </div>
                                <div class="ml-auto">
                                    <span id="retirementStatus" class="px-2 py-1 text-xs rounded-full bg-gray-700 text-gray-300">Not Started</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
        <!-- Footer with Disclaimer and Branding -->
        <footer class="premium-footer">
            <div class="container mx-auto px-4 md:px-8">
                <div class="flex flex-col md:flex-row justify-between items-center">
                    <div class="mb-4 md:mb-0">
                        <div class="brand-logo">MyDailyAgency</div>
                        <p class="text-sm text-gray-500 mt-2">Premium Financial Tools</p>
                    </div>
                    <div class="text-center md:text-right">
                        <p class="text-sm text-gray-500">Â© 2025 MyDailyAgency. All rights reserved.</p>
                    </div>
                </div>
                <div class="mt-6">
                    <div class="disclaimer">
                        <strong>Disclaimer:</strong> The True Cost Calculator is an educational tool designed to provide insights into financial decisions. 
                        The information provided by this tool is for educational purposes only and should not be considered financial advice. 
                        All calculations are based on the inputs provided and certain assumptions about market conditions, tax rates, and other factors. 
                        Past performance does not guarantee future results. Before making any financial decisions, please consult with a qualified 
                        financial advisor who can provide advice tailored to your individual circumstances. MyDailyAgency is not responsible for 
                        any decisions made based on the use of this tool.
                    </div>
                </div>
            </div>
        </footer>
    </div>
    
    <script>
        // --- App Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            initializeApp();
        });
        
        // --- State, Config, and Chart Instances ---
        const stateData = {
            'CA': { name: 'California', salesTax: 0.0725, incomeTaxRate: 0.06 },
            'OR': { name: 'Oregon', salesTax: 0.0, incomeTaxRate: 0.08 },
            'WA': { name: 'Washington', salesTax: 0.065, incomeTaxRate: 0.0 },
            'TX': { name: 'Texas', salesTax: 0.0625, incomeTaxRate: 0.0 },
            'FL': { name: 'Florida', salesTax: 0.06, incomeTaxRate: 0.0 },
            'NY': { name: 'New York', salesTax: 0.04, incomeTaxRate: 0.055 }
        };
        const FICA_RATE = 0.0765;
        const FEDERAL_TAX_RATE = 0.15;
        const LIFE_EXPECTANCY = { male: 76, female: 81 }; 
        const WAKING_HOURS_PER_YEAR = 16 * 365;
        const AVG_MARKET_RETURN = 0.07; 
        let currentGoal = { name: '', amount: 0, saved: 0 };
        let lastCalculatedCost = 0;
        let chartInstances = {};
        let userMotive = null;
        
        // Investment scenario state
        let investmentScenarios = [
            { id: 1, name: "Scenario 1", initialInvestment: 1000, monthlyContribution: 100, timeHorizon: 20, stocks: 60, bonds: 20, gold: 5, btc: 5, other: 10 }
        ];
        let maxScenarios = 5;
        let currentChartType = 'growth';
        
        // Asset return rates based on historical data and conservative projections
        const ASSET_RETURNS = {
            stocks: 0.08,    // S&P 500 historical average
            bonds: 0.04,     // Typical bond returns
            gold: 0.075,    // Historical average since 1971
            btc: 0.15,      // Conservative estimate for Bitcoin
            other: 0.06      // Real estate and commodities
        };
        
        // Debt analysis state
        let debtAnalysisData = {
            current: { months: 0, interest: 0 },
            avalanche: { months: 0, interest: 0 },
            snowball: { months: 0, interest: 0 },
            consolidation: { months: 0, interest: 0 }
        };
        
        // Individual loans state
        let individualLoans = [
            { id: 1, name: "Loan 1", amount: 5000, interestRate: 18, minPayment: 150 }
        ];
        let nextLoanId = 2;
        
        // Strategy details data
        const strategyDetails = {
            current: {
                title: "Current Plan",
                description: "Your current payment plan maintains your existing payment schedule with the addition of any extra payments you've specified. This approach keeps your payment structure the same while accelerating your debt payoff with additional funds.",
                calculation: [
                    "Total monthly payment is the sum of your minimum payments plus any extra payment",
                    "Each loan receives at least its minimum payment",
                    "Extra payments are distributed proportionally across all loans",
                    "As loans are paid off, their minimum payments are reallocated to remaining loans"
                ],
                pros: [
                    "Maintains your current payment structure",
                    "Simple to implement and track",
                    "Accelerates payoff with extra payments",
                    "No need to change payment habits"
                ],
                cons: [
                    "May not optimize for interest savings",
                    "Takes longer to pay off high-interest debt",
                    "Less psychological motivation from quick wins"
                ]
            },
            avalanche: {
                title: "Debt Avalanche",
                description: "The Debt Avalanche method focuses on paying off debts with the highest interest rates first, while making minimum payments on all other debts. This approach minimizes the total interest paid over time.",
                calculation: [
                    "Make minimum payments on all debts",
                    "Apply all extra payments to the debt with the highest interest rate",
                    "Once the highest-interest debt is paid off, focus on the next highest",
                    "Continue until all debts are paid off"
                ],
                pros: [
                    "Minimizes total interest paid",
                    "Mathematically optimal approach",
                    "Faster overall debt payoff",
                    "Good for disciplined individuals"
                ],
                cons: [
                    "May take longer to see progress on large balances",
                    "Requires discipline to stick with the plan",
                    "Less psychological motivation from quick wins"
                ]
            },
            snowball: {
                title: "Debt Snowball",
                description: "The Debt Snowball method focuses on paying off debts with the smallest balances first, while making minimum payments on all other debts. This approach creates psychological momentum as you eliminate individual debts.",
                calculation: [
                    "Make minimum payments on all debts",
                    "Apply all extra payments to the debt with the smallest balance",
                    "Once the smallest debt is paid off, focus on the next smallest",
                    "Add the payment from the paid-off debt to the next target"
                ],
                pros: [
                    "Creates psychological momentum",
                    "Provides quick wins that motivate continued progress",
                    "Simplifies your financial life over time",
                    "Good for those who need motivation boosts"
                ],
                cons: [
                    "May pay more in interest compared to avalanche",
                    "Not mathematically optimal",
                    "Takes longer to address high-interest debts"
                ]
            },
            consolidation: {
                title: "Debt Consolidation",
                description: "Debt consolidation involves combining multiple debts into a single loan with a lower interest rate. This simplifies your payments and can reduce the total interest paid.",
                calculation: [
                    "Take out a new loan at a lower interest rate",
                    "Use the funds to pay off all existing debts",
                    "Make a single monthly payment on the new loan",
                    "The payment amount is typically lower than the sum of previous payments"
                ],
                pros: [
                    "Simplifies multiple payments into one",
                    "Potentially lowers interest rate",
                    "May reduce monthly payment amount",
                    "Fixed payoff timeline"
                ],
                cons: [
                    "May require good credit to qualify",
                    "Could extend repayment period",
                    "Fees may apply for the new loan",
                    "Risk of accumulating new debt if spending habits don't change"
                ]
            }
        };
        
        // --- Utility Functions ---
        const formatCurrency = (v) => new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(v);
        const formatNumber = (v, d = 2) => Number(v).toLocaleString(undefined, { minimumFractionDigits: d, maximumFractionDigits: d });
        const formatDate = (date) => new Intl.DateTimeFormat('en-US', { year: 'numeric', month: 'long', day: 'numeric' }).format(date);
        
        // --- Tab Switching ---
        function switchTab(tabName) {
            ['calculator', 'debt', 'investment', 'motive', 'goals', 'retirement', 'health'].forEach(name => {
                const content = document.getElementById(`${name}-content`);
                const tab = document.querySelector(`[data-tab="${name}"]`);
                if (content && tab) {
                    content.classList.add('hidden');
                    tab.classList.remove('tab-active');
                }
            });
            const activeContent = document.getElementById(`${tabName}-content`);
            const activeTab = document.querySelector(`[data-tab="${tabName}"]`);
            if(activeContent && activeTab) {
                activeContent.classList.remove('hidden');
                activeTab.classList.add('tab-active');
            }
            
            // Initialize investment chart when switching to investment tab
            if (tabName === 'investment') {
                initializeInvestmentChart();
            }
            
            // Initialize debt loans when switching to debt tab
            if (tabName === 'debt') {
                initializeDebtLoans();
            }
        }
        
        // --- Core Calculation Logic ---
        function calculatePurchase(elements) {
            const age = parseInt(elements.age.value) || 0;
            const gender = elements.gender.value;
            const itemName = elements.itemName.value || "this item";
            const itemCost = parseFloat(elements.itemCost.value) || 0;
            const preTaxHourlyIncome = parseFloat(elements.preTaxHourlyIncome.value) || 0;
            const debtAmount = parseFloat(elements.debtAmount.value) || 0;
            const debtInterestRate = parseFloat(elements.debtInterestRate.value) || 0;
            
            if (itemCost <= 0 || preTaxHourlyIncome <= 0 || age <= 0) {
                alert("Please enter a valid age, cost, and pre-tax hourly income.");
                return;
            }
            
            elements.retireAge.value = age;
            elements.annualIncome.value = preTaxHourlyIncome * 40 * 52;
            const selectedState = stateData[elements.location.value];
            const totalTaxRate = FEDERAL_TAX_RATE + FICA_RATE + selectedState.incomeTaxRate;
            const netHourlyIncome = preTaxHourlyIncome * (1 - totalTaxRate);
            const salesTaxAmount = itemCost * selectedState.salesTax;
            const totalCost = itemCost + salesTaxAmount;
            lastCalculatedCost = totalCost;
            const hoursWorked = totalCost / netHourlyIncome;
            const yearsLeft = LIFE_EXPECTANCY[gender] - age;
            const hoursLeftInLife = yearsLeft > 0 ? yearsLeft * WAKING_HOURS_PER_YEAR : 0;
            const lifePercentage = hoursLeftInLife > 0 ? (hoursWorked / WAKING_HOURS_PER_YEAR) * 100 : 0;
            
            elements.resultsSection.classList.remove('hidden');
            elements.resultItemName.textContent = itemName;
            elements.totalCostWithTax.textContent = formatCurrency(totalCost);
            elements.netIncomeDisplay.textContent = formatCurrency(netHourlyIncome);
            elements.hoursWorked.textContent = formatNumber(hoursWorked, 1);
            elements.daysWorked.textContent = formatNumber(hoursWorked / 16, 1);
            elements.hoursLeft.textContent = formatNumber(hoursLeftInLife, 0);
            elements.lifePercentage.textContent = `${formatNumber(lifePercentage, 6)}%`;
            
            updateChart('futureValueChart', buildFutureValueChartConfig(totalCost));
            updateGoalTracker(elements);
            displayDynamicFact('calculator', elements);
            
            calculatePaycheckPower(totalCost, preTaxHourlyIncome, totalTaxRate, elements);
            calculateFreedomFund(totalCost, elements);
            calculateDebtImpact(totalCost, debtAmount, debtInterestRate, elements);
        }
        
        // --- New Metric Functions ---
        function calculatePaycheckPower(cost, hourly, taxRate, elements) {
            const freq = elements.paycheckFrequency.value;
            const hoursPerPaycheck = { weekly: 40, biweekly: 80, monthly: 173.33 };
            const netPaycheck = (hourly * hoursPerPaycheck[freq]) * (1 - taxRate);
            if (netPaycheck > 0) {
                const percentage = (cost / netPaycheck) * 100;
                elements.paycheckPercentage.textContent = formatNumber(percentage, 1);
            }
        }
        
        function calculateFreedomFund(cost, elements) {
            const savings = parseFloat(elements.currentSavings.value) || 0;
            const expenses = parseFloat(elements.monthlyExpenses.value) || 0;
            const card = document.getElementById('freedom-fund-card');
            if (savings > 0 && expenses > 0) {
                const runwayMonths = savings / expenses;
                const daysAdded = (cost / expenses) * 30;
                document.getElementById('runwayMonths').textContent = formatNumber(runwayMonths, 1);
                document.getElementById('runwayAdded').textContent = formatNumber(daysAdded, 1);
                card.classList.remove('hidden');
            } else {
                card.classList.add('hidden');
            }
        }
        
        function calculateDebtImpact(cost, debtAmount, interestRate, elements) {
            const card = document.getElementById('debt-impact-card');
            if (debtAmount > 0 && interestRate > 0) {
                const monthlyInterestRate = interestRate / 100 / 12;
                const currentMonthlyPayment = debtAmount * monthlyInterestRate / (1 - Math.pow(1 + monthlyInterestRate, -60)); // Assuming 5 years term
                const interestSaved = cost * (interestRate / 100);
                const timeSaved = Math.round(cost / currentMonthlyPayment);
                
                document.getElementById('debtInterestSaved').textContent = formatCurrency(interestSaved);
                document.getElementById('debtTimeSaved').textContent = timeSaved;
                card.classList.remove('hidden');
            } else {
                card.classList.add('hidden');
            }
        }
        
        // --- Charting Functions ---
        function updateChart(canvasId, config) {
            if (chartInstances[canvasId]) chartInstances[canvasId].destroy();
            const ctx = document.getElementById(canvasId).getContext('2d');
            chartInstances[canvasId] = new Chart(ctx, config);
        }
        
        function buildFutureValueChartConfig(initialCost) {
            const years = Array.from({length: 21}, (_, i) => i);
            const createProjection = (rate) => years.map(y => initialCost * Math.pow(1 + rate, y));
            return {
                type: 'line',
                data: {
                    labels: years,
                    datasets: [
                        { label: 'S&P 500 (10%)', data: createProjection(0.10), borderColor: '#22c55e', tension: 0.1, fill: false },
                        { label: 'BTC (15%)', data: createProjection(0.15), borderColor: '#f97316', tension: 0.1, fill: false },
                        { label: 'Gold (5%)', data: createProjection(0.05), borderColor: '#eab308', tension: 0.1, fill: false }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { 
                        y: { 
                            ticks: { 
                                callback: (value) => formatCurrency(value),
                                color: '#a0aec0'
                            },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        }, 
                        x: { 
                            title: { display: true, text: 'Years', color: '#a0aec0' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            ticks: { color: '#a0aec0' }
                        } 
                    },
                    plugins: { 
                        legend: { 
                            position: 'top',
                            labels: { color: '#a0aec0' }
                        },
                        title: { 
                            display: true, 
                            text: 'Future Value of Investment',
                            color: '#ffffff',
                            font: { size: 16 }
                        }
                    }
                }
            };
        }
        
        // --- Individual Loans Functions ---
        function initializeDebtLoans() {
            const loansContainer = document.getElementById('loans-container');
            loansContainer.innerHTML = '';
            
            // Add existing loans
            individualLoans.forEach(loan => {
                addLoanToUI(loan);
            });
            
            // Add event listener for adding new loans
            document.getElementById('add-loan-btn').addEventListener('click', addNewLoan);
            
            // Add event listeners for strategy details buttons
            document.querySelectorAll('.view-details-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const strategy = this.getAttribute('data-strategy');
                    showStrategyDetails(strategy);
                });
            });
            
            // Add event listener for closing strategy details modal
            document.querySelector('.strategy-details-close').addEventListener('click', function() {
                document.getElementById('strategy-details-modal').classList.remove('active');
            });
        }
        
        function addNewLoan() {
            const newLoan = {
                id: nextLoanId++,
                name: `Loan ${nextLoanId - 1}`,
                amount: 5000,
                interestRate: 18,
                minPayment: 150
            };
            
            individualLoans.push(newLoan);
            addLoanToUI(newLoan);
        }
        
        function addLoanToUI(loan) {
            const loansContainer = document.getElementById('loans-container');
            const loanElement = document.createElement('div');
            loanElement.className = 'loan-item';
            loanElement.id = `loan-${loan.id}`;
            
            loanElement.innerHTML = `
                <div class="loan-item-header">
                    <div class="loan-item-title">${loan.name}</div>
                    <button class="loan-item-remove" onclick="removeLoan(${loan.id})">
                        <i data-lucide="x" class="w-4 h-4"></i>
                    </button>
                </div>
                <div class="loan-item-details">
                    <div class="loan-item-detail">
                        <label>Loan Name</label>
                        <input type="text" value="${loan.name}" onchange="updateLoan(${loan.id}, 'name', this.value)">
                    </div>
                    <div class="loan-item-detail">
                        <label>Amount ($)</label>
                        <input type="number" value="${loan.amount}" onchange="updateLoan(${loan.id}, 'amount', parseFloat(this.value))">
                    </div>
                    <div class="loan-item-detail">
                        <label>Interest Rate (%)</label>
                        <input type="number" value="${loan.interestRate}" step="0.1" onchange="updateLoan(${loan.id}, 'interestRate', parseFloat(this.value))">
                    </div>
                    <div class="loan-item-detail">
                        <label>Min. Payment ($)</label>
                        <input type="number" value="${loan.minPayment}" onchange="updateLoan(${loan.id}, 'minPayment', parseFloat(this.value))">
                    </div>
                </div>
            `;
            
            loansContainer.appendChild(loanElement);
            lucide.createIcons();
        }
        
        function updateLoan(loanId, property, value) {
            const loan = individualLoans.find(l => l.id === loanId);
            if (loan) {
                loan[property] = value;
                
                // Update the loan name in the UI if it was changed
                if (property === 'name') {
                    document.querySelector(`#loan-${loanId} .loan-item-title`).textContent = value;
                }
            }
        }
        
        function removeLoan(loanId) {
            if (individualLoans.length <= 1) {
                alert("You must have at least one loan.");
                return;
            }
            
            individualLoans = individualLoans.filter(loan => loan.id !== loanId);
            document.getElementById(`loan-${loanId}`).remove();
        }
        
        // --- Strategy Details Modal ---
        function showStrategyDetails(strategy) {
            const modal = document.getElementById('strategy-details-modal');
            const details = strategyDetails[strategy];
            
            // Update modal content
            document.getElementById('strategy-details-title').textContent = details.title;
            document.getElementById('strategy-details-description').textContent = details.description;
            
            // Update calculation steps
            const calculationSteps = document.getElementById('strategy-details-calculation-steps');
            calculationSteps.innerHTML = '';
            details.calculation.forEach(step => {
                const li = document.createElement('li');
                li.textContent = step;
                calculationSteps.appendChild(li);
            });
            
            // Update pros
            const prosList = document.getElementById('strategy-details-pros-list');
            prosList.innerHTML = '';
            details.pros.forEach(pro => {
                const li = document.createElement('li');
                li.textContent = pro;
                prosList.appendChild(li);
            });
            
            // Update cons
            const consList = document.getElementById('strategy-details-cons-list');
            consList.innerHTML = '';
            details.cons.forEach(con => {
                const li = document.createElement('li');
                li.textContent = con;
                consList.appendChild(li);
            });
            
            // Show modal
            modal.classList.add('active');
        }
        
        // --- Enhanced Debt Impact Logic ---
        function calculateDebtPayoff(elements) {
            const monthlyIncome = parseFloat(elements.monthlyIncome.value) || 0;
            const creditScore = parseFloat(elements.creditScore.value) || 0;
            const extraPayment = parseFloat(elements.debtExtra.value) || 0;
            const totalMonthlyPayment = parseFloat(elements.totalMonthlyPayment.value) || 0;
            
            // Validate individual loans
            if (individualLoans.length === 0 || individualLoans.some(loan => loan.amount <= 0 || loan.interestRate <= 0)) {
                alert("Please enter valid loan details.");
                return;
            }
            
            // Calculate different strategies
            calculateDebtStrategies(extraPayment, totalMonthlyPayment);
            
            // Update timeline
            updateDebtTimeline(debtAnalysisData.current.months, debtAnalysisData.current.months);
            
            // Update countdown
            updateDebtCountdown(debtAnalysisData.current.months);
            
            // Update strategy comparison
            updateStrategyComparison();
            
            // Update comprehensive analysis
            updateComprehensiveAnalysis(monthlyIncome, creditScore);
            
            // Show results
            document.getElementById('debt-results').classList.remove('hidden');
            
            // Trigger celebration if debt is paid off
            if (debtAnalysisData.current.months <= 0) {
                triggerDebtFreeCelebration();
            }
            
            // Re-initialize strategy details buttons
            document.querySelectorAll('.view-details-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const strategy = this.getAttribute('data-strategy');
                    showStrategyDetails(strategy);
                });
            });
        }
        
        function calculateDebtStrategies(extraPayment, totalMonthlyPayment) {
            // Sort loans by interest rate (highest first) for avalanche
            const loansByInterest = [...individualLoans].sort((a, b) => b.interestRate - a.interestRate);
            
            // Sort loans by balance (lowest first) for snowball
            const loansByBalance = [...individualLoans].sort((a, b) => a.amount - b.amount);
            
            // Current strategy (with extra payment)
            debtAnalysisData.current = calculateMultipleLoanPayoff(individualLoans, totalMonthlyPayment + extraPayment);
            
            // Debt Avalanche (highest interest first)
            debtAnalysisData.avalanche = calculateMultipleLoanPayoff(loansByInterest, totalMonthlyPayment + extraPayment);
            
            // Debt Snowball (smallest balance first)
            debtAnalysisData.snowball = calculateMultipleLoanPayoff(loansByBalance, totalMonthlyPayment + extraPayment);
            
            // Debt Consolidation (assume 5% lower rate)
            const consolidationRate = Math.max(0, Math.max(...individualLoans.map(l => l.interestRate)) - 5);
            const consolidationLoans = individualLoans.map(loan => ({
                ...loan,
                interestRate: consolidationRate
            }));
            debtAnalysisData.consolidation = calculateMultipleLoanPayoff(consolidationLoans, totalMonthlyPayment);
        }
        
        function calculateMultipleLoanPayoff(loans, totalMonthlyPayment) {
            // Create a copy of the loans array to avoid modifying the original
            const activeLoans = loans.map(loan => ({
                ...loan,
                balance: loan.amount,
                monthlyRate: loan.interestRate / 100 / 12
            }));
            
            let months = 0;
            let totalInterest = 0;
            let remainingPayment = totalMonthlyPayment;
            
            while (activeLoans.length > 0 && months < 600) { // 50 years max
                months++;
                
                // Calculate minimum payments for all loans
                let totalMinPayment = 0;
                activeLoans.forEach(loan => {
                    const minPayment = Math.max(loan.minPayment, loan.balance * loan.monthlyRate);
                    totalMinPayment += minPayment;
                });
                
                // If total payment is less than minimum required, use minimum
                const paymentAmount = Math.max(totalMonthlyPayment, totalMinPayment);
                
                // Reset remaining payment for this month
                remainingPayment = paymentAmount;
                
                // Process each loan
                for (let i = 0; i < activeLoans.length; i++) {
                    const loan = activeLoans[i];
                    
                    if (loan.balance <= 0) continue;
                    
                    // Calculate interest for this month
                    const interestPayment = loan.balance * loan.monthlyRate;
                    totalInterest += interestPayment;
                    
                    // Determine payment for this loan
                    let loanPayment = Math.min(loan.minPayment, remainingPayment);
                    
                    // If this is the last loan or we have extra payment, apply remaining payment
                    if (i === activeLoans.length - 1 || activeLoans.every(l => l.balance <= 0 || l === loan)) {
                        loanPayment = Math.min(loan.balance + interestPayment, remainingPayment);
                    }
                    
                    // Apply payment
                    const principalPayment = Math.min(loanPayment - interestPayment, loan.balance);
                    loan.balance -= principalPayment;
                    remainingPayment -= loanPayment;
                    
                    // Remove loan if paid off
                    if (loan.balance <= 0.01) { // Small threshold to avoid floating point issues
                        activeLoans.splice(i, 1);
                        i--; // Adjust index since we removed an element
                    }
                }
            }
            
            return { months, interest: totalInterest };
        }
        
        function updateDebtTimeline(currentMonths, newMonths) {
            const timeline = document.getElementById('debtTimeline');
            const timelineProgress = document.getElementById('timelineProgress');
            
            // Clear existing milestones
            timeline.querySelectorAll('.timeline-milestone').forEach(el => el.remove());
            
            // Calculate milestone positions
            const milestones = [
                { percentage: 0, label: 'Start', date: 'Today' },
                { percentage: 25, label: '25% Paid', date: calculateMilestoneDate(newMonths, 0.25) },
                { percentage: 50, label: '50% Paid', date: calculateMilestoneDate(newMonths, 0.5) },
                { percentage: 75, label: '75% Paid', date: calculateMilestoneDate(newMonths, 0.75) },
                { percentage: 100, label: 'Debt Free!', date: calculateMilestoneDate(newMonths, 1) }
            ];
            
            // Add milestones
            milestones.forEach((milestone, index) => {
                const milestoneEl = document.createElement('div');
                milestoneEl.className = 'timeline-milestone';
                milestoneEl.style.left = `${milestone.percentage}%`;
                
                if (milestone.percentage === 100 && newMonths < currentMonths) {
                    milestoneEl.classList.add('completed');
                }
                
                milestoneEl.innerHTML = `
                    <div class="milestone-label">${milestone.label}</div>
                    <div class="milestone-date">${milestone.date}</div>
                `;
                
                timeline.appendChild(milestoneEl);
            });
            
            // Update progress bar
            timelineProgress.style.width = '0%'; // Will be animated
            setTimeout(() => {
                timelineProgress.style.width = '100%';
            }, 100);
        }
        
        function calculateMilestoneDate(totalMonths, percentage) {
            const milestoneMonths = totalMonths * percentage;
            const milestoneDate = new Date();
            milestoneDate.setMonth(milestoneDate.getMonth() + Math.floor(milestoneMonths));
            return formatDate(milestoneDate);
        }
        
        function updateDebtCountdown(months) {
            const now = new Date();
            const debtFreeDate = new Date(now);
            debtFreeDate.setMonth(debtFreeDate.getMonth() + months);
            
            const timeDiff = debtFreeDate - now;
            const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            
            document.getElementById('countdownMonths').textContent = months;
            document.getElementById('countdownDays').textContent = days;
            document.getElementById('countdownHours').textContent = hours;
            document.getElementById('debtFreeDate').textContent = formatDate(debtFreeDate);
        }
        
        function updateStrategyComparison() {
            const strategies = ['current', 'avalanche', 'snowball', 'consolidation'];
            let bestStrategy = 'current';
            let lowestInterest = debtAnalysisData.current.interest;
            let shortestTime = debtAnalysisData.current.months;
            
            strategies.forEach(strategy => {
                const card = document.querySelector(`[data-strategy="${strategy}"]`);
                const data = debtAnalysisData[strategy];
                
                card.querySelector('.strategy-time').textContent = data.months;
                card.querySelector('.strategy-interest').textContent = formatCurrency(data.interest);
                
                // Find best strategy
                if (data.interest < lowestInterest || (data.interest === lowestInterest && data.months < shortestTime)) {
                    bestStrategy = strategy;
                    lowestInterest = data.interest;
                    shortestTime = data.months;
                }
            });
            
            // Show recommendation
            const recommendationEl = document.getElementById('strategyRecommendation');
            const recommendationText = document.getElementById('recommendationText');
            
            recommendationEl.classList.remove('hidden');
            
            switch (bestStrategy) {
                case 'avalanche':
                    recommendationText.textContent = 'The Debt Avalanche method will save you the most money in interest payments by targeting high-interest debt first.';
                    break;
                case 'snowball':
                    recommendationText.textContent = 'The Debt Snowball method provides quick wins by paying off small balances first, which can help maintain motivation.';
                    break;
                case 'consolidation':
                    recommendationText.textContent = 'Debt consolidation could simplify your payments and potentially lower your interest rate, saving you money over time.';
                    break;
                default:
                    recommendationText.textContent = 'Your current payment plan with extra payments is already optimized for your situation.';
            }
            
            // Highlight recommended strategy
            document.querySelector(`[data-strategy="${bestStrategy}"]`).classList.add('recommended');
        }
        
        function updateComprehensiveAnalysis(monthlyIncome, creditScore) {
            // Calculate total debt and total minimum payments
            const totalDebt = individualLoans.reduce((sum, loan) => sum + loan.amount, 0);
            const totalMinPayment = individualLoans.reduce((sum, loan) => sum + loan.minPayment, 0);
            
            // Debt-to-Income Ratio
            const debtToIncomeRatio = monthlyIncome > 0 ? ((totalMinPayment / monthlyIncome) * 100) : 0;
            document.getElementById('debtToIncomeRatio').textContent = formatNumber(debtToIncomeRatio, 1) + '%';
            
            // Interest vs Principal
            const totalInterest = debtAnalysisData.current.interest;
            const totalPrincipal = totalDebt;
            const interestPercentage = totalPrincipal > 0 ? (totalInterest / (totalPrincipal + totalInterest)) * 100 : 0;
            document.getElementById('interestVsPrincipal').textContent = formatNumber(interestPercentage, 1) + '%';
            document.getElementById('totalInterestAmount').textContent = formatCurrency(totalInterest);
            
            // Credit Score Impact (estimated)
            const creditScoreImprovement = Math.min(100, Math.floor((totalDebt / 10000) * 10));
            document.getElementById('creditScoreImpact').textContent = `+${creditScoreImprovement}`;
            
            // Debt Freedom Date
            const freedomDate = new Date();
            freedomDate.setMonth(freedomDate.getMonth() + debtAnalysisData.current.months);
            document.getElementById('freedomDateMetric').textContent = formatDate(freedomDate);
            document.getElementById('monthsRemaining').textContent = debtAnalysisData.current.months;
            
            // Opportunity Cost
            const opportunityCost = totalInterest * Math.pow(1 + AVG_MARKET_RETURN, 10);
            document.getElementById('opportunityCost').textContent = formatCurrency(opportunityCost);
            
            // Monthly Cash Flow Improvement
            document.getElementById('cashFlowImprovement').textContent = `+${formatCurrency(totalMinPayment)}`;
            
            // Update interest vs principal chart
            updateInterestPrincipalChart(totalPrincipal, totalInterest);
        }
        
        function updateInterestPrincipalChart(principal, interest) {
            const ctx = document.getElementById('interestPrincipalChart').getContext('2d');
            
            if (chartInstances['interestPrincipalChart']) {
                chartInstances['interestPrincipalChart'].destroy();
            }
            
            chartInstances['interestPrincipalChart'] = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Principal', 'Interest'],
                    datasets: [{
                        data: [principal, interest],
                        backgroundColor: ['#4f46e5', '#ef4444'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { color: '#a0aec0' }
                        },
                        title: {
                            display: true,
                            text: 'Interest vs Principal Breakdown',
                            color: '#ffffff',
                            font: { size: 16 }
                        }
                    }
                }
            });
        }
        
        function triggerDebtFreeCelebration() {
            const celebrationEl = document.createElement('div');
            celebrationEl.className = 'fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-75';
            celebrationEl.innerHTML = `
                <div class="text-center celebration">
                    <div class="text-6xl mb-4">ðŸŽ‰</div>
                    <h2 class="text-4xl font-bold text-yellow-500 mb-2">Congratulations!</h2>
                    <p class="text-xl text-white">You're Debt Free!</p>
                    <button onclick="this.parentElement.parentElement.remove()" class="mt-6 premium-button py-2 px-6 rounded-lg">
                        Continue
                    </button>
                </div>
            `;
            document.body.appendChild(celebrationEl);
        }
        
        // --- Investment Scenario Builder Logic ---
        function initializeInvestmentChart() {
            // Set initial investment to last calculated cost if available
            if (lastCalculatedCost > 0) {
                document.getElementById('initialInvestment').value = lastCalculatedCost;
                investmentScenarios[0].initialInvestment = lastCalculatedCost;
            }
            
            // Initialize chart tabs
            document.querySelectorAll('.chart-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.chart-tab').forEach(t => {
                        t.classList.remove('active', 'bg-gray-700', 'text-white');
                        t.classList.add('bg-gray-800', 'text-gray-400');
                    });
                    tab.classList.add('active', 'bg-gray-700', 'text-white');
                    tab.classList.remove('bg-gray-800', 'text-gray-400');
                    currentChartType = tab.dataset.chart;
                    updateInvestmentChart();
                });
            });
            
            updateInvestmentChart();
            updateScenarioInputs();
            updateRecommendedAllocation();
        }
        
        function updateScenarioInputs() {
            // Update allocation values display
            const stocks = parseInt(document.getElementById('stocksAllocation').value);
            const bonds = parseInt(document.getElementById('bondsAllocation').value);
            const gold = parseInt(document.getElementById('goldAllocation').value);
            const btc = parseInt(document.getElementById('btcAllocation').value);
            const other = parseInt(document.getElementById('otherAllocation').value);
            
            // Ensure total is 100%
            const total = stocks + bonds + gold + btc + other;
            if (total !== 100) {
                // Adjust other to make total 100%
                const adjustedOther = 100 - stocks - bonds - gold - btc;
                document.getElementById('otherAllocation').value = adjustedOther;
                document.getElementById('otherValue').textContent = `${adjustedOther}%`;
            }
            
            document.getElementById('stocksValue').textContent = `${stocks}%`;
            document.getElementById('bondsValue').textContent = `${bonds}%`;
            document.getElementById('goldValue').textContent = `${gold}%`;
            document.getElementById('btcValue').textContent = `${btc}%`;
            document.getElementById('otherValue').textContent = `${document.getElementById('otherAllocation').value}%`;
            
            // Calculate expected return
            const expectedReturn = (stocks/100 * ASSET_RETURNS.stocks) + 
                                 (bonds/100 * ASSET_RETURNS.bonds) + 
                                 (gold/100 * ASSET_RETURNS.gold) + 
                                 (parseInt(document.getElementById('btcAllocation').value)/100 * ASSET_RETURNS.btc) + 
                                 (parseInt(document.getElementById('otherAllocation').value)/100 * ASSET_RETURNS.other);
            
            document.getElementById('expectedReturn').textContent = `${(expectedReturn * 100).toFixed(1)}%`;
            
            // Update time horizon display
            const timeHorizon = document.getElementById('timeHorizon').value;
            document.getElementById('timeHorizonValue').textContent = `${timeHorizon} years`;
            
            // Update scenario data
            investmentScenarios[0].initialInvestment = parseFloat(document.getElementById('initialInvestment').value) || 0;
            investmentScenarios[0].monthlyContribution = parseFloat(document.getElementById('monthlyContribution').value) || 0;
            investmentScenarios[0].timeHorizon = parseInt(timeHorizon);
            investmentScenarios[0].stocks = stocks;
            investmentScenarios[0].bonds = bonds;
            investmentScenarios[0].gold = gold;
            investmentScenarios[0].btc = btc;
            investmentScenarios[0].other = parseInt(document.getElementById('otherAllocation').value);
            
            updateInvestmentChart();
            updateWhatIfAnalysis();
        }
        
        function updateInvestmentChart() {
            const ctx = document.getElementById('investmentChart').getContext('2d');
            
            if (chartInstances['investmentChart']) {
                chartInstances['investmentChart'].destroy();
            }
            
            let config;
            
            switch (currentChartType) {
                case 'growth':
                    config = buildGrowthChartConfig();
                    break;
                case 'allocation':
                    config = buildAllocationChartConfig();
                    break;
                case 'waterfall':
                    config = buildWaterfallChartConfig();
                    break;
                case 'montecarlo':
                    config = buildMonteCarloChartConfig();
                    break;
                case 'timeline':
                    config = buildTimelineChartConfig();
                    break;
            }
            
            chartInstances['investmentChart'] = new Chart(ctx, config);
            updateScenarioTable();
        }
        
        function buildGrowthChartConfig() {
            const showRealReturns = document.getElementById('showRealReturns').checked;
            const inflationRate = parseFloat(document.getElementById('inflationRate').value) / 100;
            
            // Generate data for each scenario
            const datasets = [];
            const colors = ['#4f46e5', '#10b981', '#f59e0b', '#f97316', '#8b5cf6'];
            
            investmentScenarios.forEach((scenario, index) => {
                const expectedReturn = (scenario.stocks/100 * ASSET_RETURNS.stocks) + 
                                     (scenario.bonds/100 * ASSET_RETURNS.bonds) + 
                                     (scenario.gold/100 * ASSET_RETURNS.gold) + 
                                     (scenario.btc/100 * ASSET_RETURNS.btc) + 
                                     (scenario.other/100 * ASSET_RETURNS.other);
                
                const monthlyRate = expectedReturn / 12;
                const months = scenario.timeHorizon * 12;
                
                // Calculate year-by-year values
                const data = [];
                let value = scenario.initialInvestment;
                
                for (let year = 0; year <= scenario.timeHorizon; year++) {
                    if (showRealReturns) {
                        data.push(value / Math.pow(1 + inflationRate, year));
                    } else {
                        data.push(value);
                    }
                    
                    // Calculate value at end of year
                    for (let month = 1; month <= 12; month++) {
                        if ((year * 12 + month) > months) break;
                        value = value * (1 + monthlyRate) + scenario.monthlyContribution;
                    }
                }
                
                datasets.push({
                    label: scenario.name,
                    data: data,
                    borderColor: colors[index % colors.length],
                    backgroundColor: `${colors[index % colors.length]}20`,
                    tension: 0.1,
                    fill: false
                });
            });
            
            // Generate labels (years)
            const labels = [];
            const maxYears = Math.max(...investmentScenarios.map(s => s.timeHorizon));
            for (let i = 0; i <= maxYears; i++) {
                labels.push(i.toString());
            }
            
            return {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            ticks: {
                                callback: (value) => formatCurrency(value),
                                color: '#a0aec0'
                            },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Years',
                                color: '#a0aec0'
                            },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            ticks: { color: '#a0aec0' }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: { color: '#a0aec0' }
                        },
                        title: {
                            display: true,
                            text: `Investment Growth Projection ${showRealReturns ? '(Real Returns)' : '(Nominal Returns)'}`,
                            color: '#ffffff',
                            font: { size: 16 }
                        },
                        tooltip: {
                            callbacks: {
                                label: (context) => {
                                    return `${context.dataset.label}: ${formatCurrency(context.raw)}`;
                                }
                            }
                        }
                    }
                }
            };
        }
        
        function buildAllocationChartConfig() {
            const scenario = investmentScenarios[0];
            const data = [
                scenario.stocks,
                scenario.bonds,
                scenario.gold,
                scenario.btc,
                scenario.other
            ];
            const labels = ['Stocks', 'Bonds', 'Gold', 'Bitcoin', 'Other'];
            const colors = ['#4f46e5', '#10b981', '#f59e0b', '#f97316', '#8b5cf6'];
            
            return {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors,
                        borderColor: 'rgba(26, 31, 46, 0.8)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: { color: '#a0aec0' }
                        },
                        title: {
                            display: true,
                            text: 'Asset Allocation',
                            color: '#ffffff',
                            font: { size: 16 }
                        },
                        tooltip: {
                            callbacks: {
                                label: (context) => {
                                    return `${context.label}: ${context.parsed}%`;
                                }
                            }
                        }
                    }
                }
            };
        }
        
        function buildWaterfallChartConfig() {
            const scenario = investmentScenarios[0];
            const expectedReturn = (scenario.stocks/100 * ASSET_RETURNS.stocks) + 
                                 (scenario.bonds/100 * ASSET_RETURNS.bonds) + 
                                 (scenario.gold/100 * ASSET_RETURNS.gold) + 
                                 (scenario.btc/100 * ASSET_RETURNS.btc) + 
                                 (scenario.other/100 * ASSET_RETURNS.other);
            
            const monthlyRate = expectedReturn / 12;
            const months = scenario.timeHorizon * 12;
            
            let totalContributions = scenario.initialInvestment;
            let totalGrowth = 0;
            let value = scenario.initialInvestment;
            
            // Calculate final values
            for (let month = 1; month <= months; month++) {
                const growth = value * monthlyRate;
                totalGrowth += growth;
                value = value * (1 + monthlyRate) + scenario.monthlyContribution;
                totalContributions += scenario.monthlyContribution;
            }
            
            return {
                type: 'bar',
                data: {
                    labels: ['Initial Investment', 'Monthly Contributions', 'Growth'],
                    datasets: [{
                        label: 'Portfolio Value',
                        data: [
                            scenario.initialInvestment,
                            totalContributions - scenario.initialInvestment,
                            totalGrowth
                        ],
                        backgroundColor: ['#4f46e5', '#10b981', '#f59e0b']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            ticks: {
                                callback: (value) => formatCurrency(value),
                                color: '#a0aec0'
                            },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        x: {
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            ticks: { color: '#a0aec0' }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: 'Contributions vs Growth',
                            color: '#ffffff',
                            font: { size: 16 }
                        },
                        tooltip: {
                            callbacks: {
                                label: (context) => {
                                    return `${context.label}: ${formatCurrency(context.raw)}`;
                                }
                            }
                        }
                    }
                }
            };
        }
        
        function buildMonteCarloChartConfig() {
            const scenario = investmentScenarios[0];
            const expectedReturn = (scenario.stocks/100 * ASSET_RETURNS.stocks) + 
                                 (scenario.bonds/100 * ASSET_RETURNS.bonds) + 
                                 (scenario.gold/100 * ASSET_RETURNS.gold) + 
                                 (scenario.btc/100 * ASSET_RETURNS.btc) + 
                                 (scenario.other/100 * ASSET_RETURNS.other);
            
            const monthlyRate = expectedReturn / 12;
            const months = scenario.timeHorizon * 12;
            const volatility = 0.15; // Annual volatility assumption
            const simulations = 1000;
            
            // Run Monte Carlo simulation
            const finalValues = [];
            
            for (let sim = 0; sim < simulations; sim++) {
                let value = scenario.initialInvestment;
                
                for (let month = 1; month <= months; month++) {
                    const randomReturn = monthlyRate + (Math.random() - 0.5) * volatility / Math.sqrt(12);
                    value = value * (1 + randomReturn) + scenario.monthlyContribution;
                }
                
                finalValues.push(value);
            }
            
            // Create percentiles
            finalValues.sort((a, b) => a - b);
            const percentiles = [10, 25, 50, 75, 90];
            const percentileValues = percentiles.map(p => finalValues[Math.floor(simulations * p / 100)]);
            
            return {
                type: 'bar',
                data: {
                    labels: percentiles.map(p => `${p}th Percentile`),
                    datasets: [{
                        label: 'Portfolio Value',
                        data: percentileValues,
                        backgroundColor: percentiles.map(p => {
                            if (p <= 25) return '#ef4444';
                            if (p <= 75) return '#f59e0b';
                            return '#10b981';
                        })
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            ticks: {
                                callback: (value) => formatCurrency(value),
                                color: '#a0aec0'
                            },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        x: {
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            ticks: { color: '#a0aec0' }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: 'Monte Carlo Simulation (1000 runs)',
                            color: '#ffffff',
                            font: { size: 16 }
                        },
                        tooltip: {
                            callbacks: {
                                label: (context) => {
                                    return `${context.label}: ${formatCurrency(context.raw)}`;
                                }
                            }
                        }
                    }
                }
            };
        }
        
        function buildTimelineChartConfig() {
            const scenario = investmentScenarios[0];
            const expectedReturn = (scenario.stocks/100 * ASSET_RETURNS.stocks) + 
                                 (scenario.bonds/100 * ASSET_RETURNS.bonds) + 
                                 (scenario.gold/100 * ASSET_RETURNS.gold) + 
                                 (scenario.btc/100 * ASSET_RETURNS.btc) + 
                                 (scenario.other/100 * ASSET_RETURNS.other);
            
            const monthlyRate = expectedReturn / 12;
            const targetAmounts = [100000, 250000, 500000, 1000000];
            const timelineData = [];
            
            targetAmounts.forEach(target => {
                let value = scenario.initialInvestment;
                let months = 0;
                
                while (value < target && months < 600) {
                    value = value * (1 + monthlyRate) + scenario.monthlyContribution;
                    months++;
                }
                
                timelineData.push({
                    target: target,
                    months: months,
                    years: months / 12
                });
            });
            
            return {
                type: 'bar',
                data: {
                    labels: targetAmounts.map(a => formatCurrency(a)),
                    datasets: [{
                        label: 'Years to Reach Goal',
                        data: timelineData.map(d => d.years),
                        backgroundColor: '#4f46e5'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            title: {
                                display: true,
                                text: 'Years',
                                color: '#a0aec0'
                            },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            ticks: { color: '#a0aec0' }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Target Amount',
                                color: '#a0aec0'
                            },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            ticks: { color: '#a0aec0' }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: 'Time to Reach Financial Milestones',
                            color: '#ffffff',
                            font: { size: 16 }
                        },
                        tooltip: {
                            callbacks: {
                                label: (context) => {
                                    const data = timelineData[context.dataIndex];
                                    return [
                                        `Target: ${formatCurrency(data.target)}`,
                                        `Years: ${formatNumber(data.years, 1)}`,
                                        `Months: ${data.months}`
                                    ];
                                }
                            }
                        }
                    }
                }
            };
        }
        
        function updateScenarioTable() {
            const tbody = document.getElementById('scenarioTableBody');
            tbody.innerHTML = '';
            
            investmentScenarios.forEach((scenario, index) => {
                const expectedReturn = (scenario.stocks/100 * ASSET_RETURNS.stocks) + 
                                     (scenario.bonds/100 * ASSET_RETURNS.bonds) + 
                                     (scenario.gold/100 * ASSET_RETURNS.gold) + 
                                     (scenario.btc/100 * ASSET_RETURNS.btc) + 
                                     (scenario.other/100 * ASSET_RETURNS.other);
                
                const monthlyRate = expectedReturn / 12;
                const months = scenario.timeHorizon * 12;
                
                // Calculate final value
                let value = scenario.initialInvestment;
                for (let month = 1; month <= months; month++) {
                    value = value * (1 + monthlyRate) + scenario.monthlyContribution;
                }
                
                const totalContributions = scenario.initialInvestment + (scenario.monthlyContribution * months);
                const interestEarned = value - totalContributions;
                const cagr = Math.pow(value / scenario.initialInvestment, 1 / scenario.timeHorizon) - 1;
                
                // Calculate risk score (simplified)
                const riskScore = (scenario.stocks * 0.8 + scenario.btc * 1.0 + scenario.gold * 0.6 + scenario.other * 0.4) / 100;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${scenario.name}</strong></td>
                    <td>${formatCurrency(value)}</td>
                    <td>${formatCurrency(totalContributions)}</td>
                    <td>${formatCurrency(interestEarned)}</td>
                    <td>${(cagr * 100).toFixed(1)}%</td>
                    <td>${riskScore.toFixed(1)}/10</td>
                    <td>
                        ${index > 0 ? `<button class="text-red-500 hover:text-red-400" onclick="removeScenario(${index})"><i data-lucide="trash-2" class="w-4 h-4"></i></button>` : ''}
                    </td>
                `;
                tbody.appendChild(row);
            });
            
            lucide.createIcons();
        }
        
        function updateWhatIfAnalysis() {
            const scenario = investmentScenarios[0];
            const expectedReturn = (scenario.stocks/100 * ASSET_RETURNS.stocks) + 
                                 (scenario.bonds/100 * ASSET_RETURNS.bonds) + 
                                 (scenario.gold/100 * ASSET_RETURNS.gold) + 
                                 (scenario.btc/100 * ASSET_RETURNS.btc) + 
                                 (scenario.other/100 * ASSET_RETURNS.other);
            
            const monthlyRate = expectedReturn / 12;
            const months = scenario.timeHorizon * 12;
            
            // Calculate base value
            let baseValue = scenario.initialInvestment;
            for (let month = 1; month <= months; month++) {
                baseValue = baseValue * (1 + monthlyRate) + scenario.monthlyContribution;
            }
            
            // +1% return
            let plusOneValue = scenario.initialInvestment;
            const plusOneRate = (expectedReturn + 0.01) / 12;
            for (let month = 1; month <= months; month++) {
                plusOneValue = plusOneValue * (1 + plusOneRate) + scenario.monthlyContribution;
            }
            
            // +$50/month
            let plusFiftyValue = scenario.initialInvestment;
            for (let month = 1; month <= months; month++) {
                plusFiftyValue = plusFiftyValue * (1 + monthlyRate) + (scenario.monthlyContribution + 50);
            }
            
            // +5 years
            let plusFiveValue = scenario.initialInvestment;
            const plusFiveMonths = (scenario.timeHorizon + 5) * 12;
            for (let month = 1; month <= plusFiveMonths; month++) {
                plusFiveValue = plusFiveValue * (1 + monthlyRate) + scenario.monthlyContribution;
            }
            
            document.getElementById('plusOnePercent').textContent = `+${formatCurrency(plusOneValue - baseValue)}`;
            document.getElementById('plusFiftyMonthly').textContent = `+${formatCurrency(plusFiftyValue - baseValue)}`;
            document.getElementById('plusFiveYears').textContent = `+${formatCurrency(plusFiveValue - baseValue)}`;
        }
        
        function updateRecommendedAllocation() {
            const age = parseInt(document.getElementById('age').value) || 30;
            const retirementYear = parseInt(document.getElementById('retireAge').value) || 65;
            const yearsToRetirement = retirementYear - age;
            
            let recommendedStocks, recommendedBonds, recommendedGold, recommendedBtc, recommendedOther;
            
            if (yearsToRetirement > 30) {
                // Aggressive allocation for young investors
                recommendedStocks = 80;
                recommendedBonds = 10;
                recommendedGold = 5;
                recommendedBtc = 3;
                recommendedOther = 2;
            } else if (yearsToRetirement > 20) {
                // Growth allocation
                recommendedStocks = 65;
                recommendedBonds = 20;
                recommendedGold = 5;
                recommendedBtc = 5;
                recommendedOther = 5;
            } else if (yearsToRetirement > 10) {
                // Balanced allocation
                recommendedStocks = 50;
                recommendedBonds = 35;
                recommendedGold = 5;
                recommendedBtc = 2;
                recommendedOther = 8;
            } else {
                // Conservative allocation
                recommendedStocks = 30;
                recommendedBonds = 50;
                recommendedGold = 10;
                recommendedBtc = 0;
                recommendedOther = 10;
            }
            
            const recommendedText = `Stocks: ${recommendedStocks}%, Bonds: ${recommendedBonds}%, Gold: ${recommendedGold}%, Bitcoin: ${recommendedBtc}%, Other: ${recommendedOther}%`;
            document.getElementById('recommendedAllocation').textContent = recommendedText;
            
            // Store recommended values for apply button
            window.recommendedAllocation = {
                stocks: recommendedStocks,
                bonds: recommendedBonds,
                gold: recommendedGold,
                btc: recommendedBtc,
                other: recommendedOther
            };
        }
        
        function applyRecommendedAllocation() {
            if (window.recommendedAllocation) {
                const rec = window.recommendedAllocation;
                document.getElementById('stocksAllocation').value = rec.stocks;
                document.getElementById('bondsAllocation').value = rec.bonds;
                document.getElementById('goldAllocation').value = rec.gold;
                document.getElementById('btcAllocation').value = rec.btc;
                document.getElementById('otherAllocation').value = rec.other;
                updateScenarioInputs();
            }
        }
        
        function addScenario() {
            if (investmentScenarios.length >= maxScenarios) {
                alert(`You can only compare up to ${maxScenarios} scenarios.`);
                return;
            }
            
            const newId = investmentScenarios.length + 1;
            investmentScenarios.push({
                id: newId,
                name: `Scenario ${newId}`,
                initialInvestment: parseFloat(document.getElementById('initialInvestment').value) || 1000,
                monthlyContribution: parseFloat(document.getElementById('monthlyContribution').value) || 100,
                timeHorizon: parseInt(document.getElementById('timeHorizon').value) || 20,
                stocks: parseInt(document.getElementById('stocksAllocation').value) || 60,
                bonds: parseInt(document.getElementById('bondsAllocation').value) || 20,
                gold: parseInt(document.getElementById('goldAllocation').value) || 5,
                btc: parseInt(document.getElementById('btcAllocation').value) || 5,
                other: parseInt(document.getElementById('otherAllocation').value) || 10
            });
            
            updateInvestmentChart();
        }
        
        function removeScenario(index) {
            if (investmentScenarios.length <= 1) {
                alert("You must have at least one scenario.");
                return;
            }
            
            investmentScenarios.splice(index, 1);
            
            // Rename scenarios
            investmentScenarios.forEach((scenario, i) => {
                scenario.id = i + 1;
                scenario.name = `Scenario ${i + 1}`;
            });
            
            updateInvestmentChart();
        }
        
        function resetScenarios() {
            investmentScenarios = [
                { id: 1, name: "Scenario 1", initialInvestment: 1000, monthlyContribution: 100, timeHorizon: 20, stocks: 60, bonds: 20, gold: 5, btc: 5, other: 10 }
            ];
            
            // Reset form values
            document.getElementById('initialInvestment').value = 1000;
            document.getElementById('monthlyContribution').value = 100;
            document.getElementById('timeHorizon').value = 20;
            document.getElementById('stocksAllocation').value = 60;
            document.getElementById('bondsAllocation').value = 20;
            document.getElementById('goldAllocation').value = 5;
            document.getElementById('btcAllocation').value = 5;
            document.getElementById('otherAllocation').value = 10;
            
            updateScenarioInputs();
        }
        
        // --- Financial Health Logic ---
        function calculateFinancialHealth(elements) {
            const income = parseFloat(elements.healthIncome.value) || 0;
            const expenses = parseFloat(elements.healthExpenses.value) || 0;
            const savings = parseFloat(elements.healthSavings.value) || 0;
            const debt = parseFloat(elements.healthDebt.value) || 0;
            
            if (income <= 0) {
                alert("Please enter a valid monthly income.");
                return;
            }
            
            // Calculate metrics
            const savingsRate = ((income - expenses) / income) * 100;
            const debtRatio = (debt / income) * 100;
            const emergencyFundMonths = savings / expenses;
            
            // Calculate health score (0-100)
            let score = 0;
            
            // Savings rate (30 points)
            if (savingsRate >= 20) score += 30;
            else if (savingsRate >= 15) score += 25;
            else if (savingsRate >= 10) score += 20;
            else if (savingsRate >= 5) score += 15;
            else score += Math.max(0, savingsRate * 3);
            
            // Debt ratio (30 points)
            if (debtRatio <= 10) score += 30;
            else if (debtRatio <= 20) score += 25;
            else if (debtRatio <= 30) score += 20;
            else if (debtRatio <= 40) score += 15;
            else score += Math.max(0, 30 - (debtRatio - 40) * 0.5);
            
            // Emergency fund (40 points)
            if (emergencyFundMonths >= 6) score += 40;
            else if (emergencyFundMonths >= 3) score += 30;
            else if (emergencyFundMonths >= 1) score += 20;
            else score += Math.max(0, emergencyFundMonths * 20);
            
            // Update UI
            document.getElementById('healthScoreText').textContent = Math.round(score);
            document.getElementById('healthScoreCircle').style.setProperty('--score', `${score}%`);
            
            // Update description
            let description = "";
            if (score >= 80) {
                description = "Excellent! Your financial health is in great shape. Keep up the good work!";
            } else if (score >= 60) {
                description = "Good! You're on the right track, but there's room for improvement.";
            } else if (score >= 40) {
                description = "Fair. Your financial health needs attention. Focus on building savings and reducing debt.";
            } else {
                description = "Needs improvement. It's time to take action and make changes to your financial habits.";
            }
            document.getElementById('healthScoreDescription').textContent = description;
            
            // Update metrics bars
            document.getElementById('savingsRateBar').style.width = `${Math.min(100, savingsRate * 2)}%`;
            document.getElementById('savingsRateValue').textContent = formatNumber(savingsRate, 1);
            
            document.getElementById('debtRatioBar').style.width = `${Math.min(100, debtRatio)}%`;
            document.getElementById('debtRatioValue').textContent = formatNumber(debtRatio, 1);
            
            document.getElementById('emergencyFundBar').style.width = `${Math.min(100, emergencyFundMonths * 16.67)}%`;
            document.getElementById('emergencyFundValue').textContent = formatNumber(emergencyFundMonths, 1);
            
            // Generate recommendations
            const recommendations = [];
            
            if (savingsRate < 10) {
                recommendations.push({
                    icon: 'piggy-bank',
                    title: 'Increase Your Savings Rate',
                    description: 'Aim to save at least 10-15% of your income. Start by cutting small expenses and automating savings.'
                });
            }
            
            if (debtRatio > 30) {
                recommendations.push({
                    icon: 'credit-card',
                    title: 'Reduce Your Debt',
                    description: 'Focus on paying down high-interest debt first. Consider the debt avalanche or snowball method.'
                });
            }
            
            if (emergencyFundMonths < 3) {
                recommendations.push({
                    icon: 'shield',
                    title: 'Build Your Emergency Fund',
                    description: 'Aim to save 3-6 months of expenses. Start with a small goal of $500 and build from there.'
                });
            }
            
            if (savingsRate >= 15 && debtRatio <= 20 && emergencyFundMonths >= 3) {
                recommendations.push({
                    icon: 'trending-up',
                    title: 'Invest for the Future',
                    description: 'Consider opening an investment account to grow your wealth over time.'
                });
            }
            
            const recommendationsContainer = document.getElementById('healthRecommendations');
            recommendationsContainer.innerHTML = '';
            
            recommendations.forEach(rec => {
                const div = document.createElement('div');
                div.className = 'flex items-start';
                div.innerHTML = `
                    <div class="flex-shrink-0 mt-1">
                        <i data-lucide="${rec.icon}" class="w-5 h-5 text-yellow-500"></i>
                    </div>
                    <div class="ml-3">
                        <h5 class="font-medium">${rec.title}</h5>
                        <p class="text-sm text-gray-400">${rec.description}</p>
                    </div>
                `;
                recommendationsContainer.appendChild(div);
            });
            
            // Update milestone statuses
            const emergencyStatus = document.getElementById('emergencyFundStatus');
            if (emergencyFundMonths >= 6) {
                emergencyStatus.textContent = 'Complete';
                emergencyStatus.className = 'px-2 py-1 text-xs rounded-full bg-green-900/30 text-green-400';
            } else if (emergencyFundMonths >= 3) {
                emergencyStatus.textContent = 'In Progress';
                emergencyStatus.className = 'px-2 py-1 text-xs rounded-full bg-yellow-900/30 text-yellow-400';
            } else {
                emergencyStatus.textContent = 'Not Started';
                emergencyStatus.className = 'px-2 py-1 text-xs rounded-full bg-red-900/30 text-red-400';
            }
            
            const debtStatus = document.getElementById('debtStatus');
            if (debtRatio <= 10) {
                debtStatus.textContent = 'Complete';
                debtStatus.className = 'px-2 py-1 text-xs rounded-full bg-green-900/30 text-green-400';
            } else if (debtRatio <= 20) {
                debtStatus.textContent = 'In Progress';
                debtStatus.className = 'px-2 py-1 text-xs rounded-full bg-yellow-900/30 text-yellow-400';
            } else {
                debtStatus.textContent = 'Not Started';
                debtStatus.className = 'px-2 py-1 text-xs rounded-full bg-red-900/30 text-red-400';
            }
            
            const retirementStatus = document.getElementById('retirementStatus');
            const retirementSavingsRate = 15; // Assuming 15% is the target
            if (savingsRate >= retirementSavingsRate) {
                retirementStatus.textContent = 'On Track';
                retirementStatus.className = 'px-2 py-1 text-xs rounded-full bg-green-900/30 text-green-400';
            } else if (savingsRate >= retirementSavingsRate * 0.7) {
                retirementStatus.textContent = 'In Progress';
                retirementStatus.className = 'px-2 py-1 text-xs rounded-full bg-yellow-900/30 text-yellow-400';
            } else {
                retirementStatus.textContent = 'Needs Attention';
                retirementStatus.className = 'px-2 py-1 text-xs rounded-full bg-red-900/30 text-red-400';
            }
            
            document.getElementById('health-results').classList.remove('hidden');
            lucide.createIcons();
        }
        
        // --- Goal Logic ---
        function setGoal(elements) {
            const goalName = elements.goalName.value;
            const goalAmount = parseFloat(elements.goalAmount.value);
            const currentSavings = parseFloat(elements.currentGoalSavings.value) || 0;
            if (!goalName || goalAmount <= 0) {
                alert("Please enter a valid goal name and amount.");
                return;
            }
            currentGoal = { name: goalName, amount: goalAmount, saved: currentSavings };
            alert(`Goal Set: ${goalName} for ${formatCurrency(goalAmount)}`);
            updateGoalTracker(elements);
            displayDynamicFact('goals', elements);
        }
        
        function updateGoalTracker(elements) {
            if (currentGoal.amount <= 0) return;
            elements.goalTrackerSection.classList.remove('hidden');
            elements.goalResultName.textContent = currentGoal.name;
            elements.goalItemName.textContent = elements.itemName.value || "purchase";
            elements.goalContribution.textContent = formatCurrency(lastCalculatedCost);
            updateChart('goalDonutChart', buildGoalDonutChartConfig());
        }
        
        function buildGoalDonutChartConfig() {
            const { amount, saved } = currentGoal;
            const potentialSave = lastCalculatedCost > 0 ? lastCalculatedCost : 0;
            const remaining = amount - saved - potentialSave;
            return {
                type: 'doughnut',
                data: {
                    labels: ['Current Savings', 'This Purchase', 'Remaining'],
                    datasets: [{
                        data: [saved, potentialSave, Math.max(0, remaining)],
                        backgroundColor: ['#4f46e5', '#10b981', 'rgba(255, 255, 255, 0.1)'],
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { 
                        legend: { 
                            position: 'bottom',
                            labels: { color: '#a0aec0' }
                        }, 
                        title: { 
                            display: true, 
                            text: `Goal: ${formatCurrency(amount)}`,
                            color: '#ffffff',
                            font: { size: 16 }
                        }
                    }
                }
            };
        }
        
        // --- Retirement Logic ---
        function calculateYearsToRetire(startSavings, annualSavings, fiNumber) {
            let currentSavings = startSavings;
            let years = 0;
            while (currentSavings < fiNumber && years < 100) {
                currentSavings = currentSavings * (1 + AVG_MARKET_RETURN) + annualSavings;
                years++;
            }
            return years;
        }
        
        function handleRetirementCalculation(elements) {
            const age = parseInt(elements.retireAge.value) || 0;
            const annualIncome = parseFloat(elements.annualIncome.value) || 0;
            const currentRetireSavings = parseFloat(elements.currentRetireSavings.value) || 0;
            const savingsRate = parseFloat(elements.savingsRate.value) / 100 || 0;
            const annualExpenses = parseFloat(elements.annualExpenses.value) || 0;
            const retirementDream = elements.retirementDream.value || "achieving your dream";
            if (age <= 0 || annualIncome <= 0 || savingsRate <= 0 || annualExpenses <= 0) {
                alert("Please fill in all retirement fields with valid numbers.");
                return;
            }
            const fiNumber = annualExpenses * 25;
            const annualSavings = annualIncome * savingsRate;
            const yearsToRetire = calculateYearsToRetire(currentRetireSavings, annualSavings, fiNumber);
            const retirementAge = age + yearsToRetire;
            elements.retirementResultsSection.classList.remove('hidden');
            elements.dreamDisplay.textContent = retirementDream;
            elements.retirementAgeResult.textContent = retirementAge;
            elements.fiNumberResult.textContent = formatCurrency(fiNumber);
            elements.withdrawalResult.textContent = formatCurrency(fiNumber * 0.04);
            elements.retireItemName.textContent = elements.itemName.value || 'purchase';
            
            const baseScenario = { years: yearsToRetire, age: retirementAge };
            updatePurchaseImpact(baseScenario, annualExpenses, elements);
            updateTimeValueTable(baseScenario, elements);
            displayDynamicFact('retirement', elements);
        }
        
        function updatePurchaseImpact(baseScenario, annualExpenses, elements) {
            const hourlyRetirementCost = annualExpenses / WAKING_HOURS_PER_YEAR;
            const futureValue = lastCalculatedCost * Math.pow(1 + AVG_MARKET_RETURN, baseScenario.years);
            const hoursBought = futureValue / hourlyRetirementCost;
            const daysBought = hoursBought / 16;
            
            elements.purchaseImpactResult.innerHTML = `
                <p class="font-bold text-2xl text-green-500">+ ${formatNumber(hoursBought, 0)} hours</p>
                <p class="text-sm text-green-400">(${formatNumber(daysBought, 1)} days of freedom)</p>
                <p class="text-xs text-gray-500 mt-2">
                    Assumes purchase amount is invested at ${AVG_MARKET_RETURN * 100}% annually until your retirement at age ${baseScenario.age}.
                </p>
            `;
            
            updateRetirementMeaning(hoursBought, elements);
        }
        
        function updateRetirementMeaning(hours, elements) {
            let message = '';
            if (hours > 1000) {
                message = `With over <strong class="text-yellow-500">${formatNumber(hours,0)} extra hours</strong>, you could take a multi-month international trip, write a novel, or dedicate a significant amount of time to a cause you're passionate about. This isn't just a purchase; it's a life-changing amount of freedom.`;
            } else if (hours > 160) {
                message = `Those <strong class="text-yellow-500">${formatNumber(hours,0)} hours</strong> are enough for a long vacation, to complete an online certification to boost your skills, or to spend an entire month of afternoons with your family, completely stress-free.`;
            } else if (hours > 40) {
                message = `What could you do with an extra <strong class="text-yellow-500">${formatNumber(hours,0)} hours</strong> of your life? That's a full week to learn a new hobby, tackle a home project, or simply relax and recharge.`;
            } else {
                message = `Even <strong class="text-yellow-500">${formatNumber(hours,0)} hours</strong> is precious. That's several long weekends, dozens of dinners with friends, or countless moments spent on your own terms, not someone else's.`;
            }
            elements.retirementMeaning.innerHTML = message;
        }
        
        function updateTimeValueTable(scenario, elements) {
            const gender = elements.gender.value;
            const lifeExpectancy = LIFE_EXPECTANCY[gender];
            
            const yearsWorking = scenario.years;
            const yearsRetired = lifeExpectancy - scenario.age;
            const hoursWorking = yearsWorking * 40 * 52;
            const hoursRetired = yearsRetired * WAKING_HOURS_PER_YEAR;
            const daysWorking = hoursWorking / 16;
            const daysRetired = hoursRetired / 16;
            const birthdaysWorking = yearsWorking;
            const birthdaysRetired = yearsRetired;
            
            elements.timeValueTable.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="p-4 rounded-lg bg-gradient-to-r from-red-900/20 to-red-800/20 text-center">
                        <h4 class="font-bold text-lg flex items-center justify-center"><i data-lucide="briefcase" class="w-5 h-5 mr-2"></i>The Working Years</h4>
                        <div class="mt-2 space-y-1">
                            <p><strong class="text-2xl text-red-500">${formatNumber(birthdaysWorking, 0)}</strong> Birthdays</p>
                            <p><strong class="text-lg text-red-400">${formatNumber(daysWorking, 0)}</strong> Waking Days</p>
                            <p><strong class="text-lg text-red-400">${formatNumber(hoursWorking, 0)}</strong> Waking Hours</p>
                        </div>
                    </div>
                    <div class="p-4 rounded-lg bg-gradient-to-r from-green-900/20 to-green-800/20 text-center">
                        <h4 class="font-bold text-lg flex items-center justify-center"><i data-lucide="sunset" class="w-5 h-5 mr-2"></i>The Freedom Years</h4>
                         <div class="mt-2 space-y-1">
                            <p><strong class="text-2xl text-green-500">${formatNumber(birthdaysRetired, 0)}</strong> Birthdays</p>
                            <p><strong class="text-lg text-green-400">${formatNumber(daysRetired, 0)}</strong> Waking Days</p>
                            <p><strong class="text-lg text-green-400">${formatNumber(hoursRetired, 0)}</strong> Waking Hours</p>
                        </div>
                    </div>
                </div>
            `;
            lucide.createIcons();
        }
        
        // --- Money Motive Quiz Logic ---
        const quizData = [
            { question: "When you get an unexpected bonus, your first thought is:", answers: [ { text: "Put it straight into savings or investments.", motive: "Security" }, { text: "Book a flight for a spontaneous trip.", motive: "Experience" }, { text: "Treat your friends or family to a nice dinner.", motive: "Generous" }, { text: "Buy that designer item you've been eyeing.", motive: "Status" } ] },
            { question: "You're most likely to spend money on:", answers: [ { text: "A course to learn a new skill.", motive: "Security" }, { text: "Tickets to a concert or festival.", motive: "Experience" }, { text: "A donation to a cause you care about.", motive: "Generous" }, { text: "Upgrading your car or phone.", motive: "Status" } ] },
            { question: "Your ideal weekend involves:", answers: [ { text: "Organizing your finances and planning for the future.", motive: "Security" }, { text: "Exploring a new city or hiking trail.", motive: "Experience" }, { text: "Volunteering or hosting a get-together.", motive: "Generous" }, { text: "Shopping at a high-end mall.", motive: "Status" } ] },
            { question: "When you think about money, you feel most successful when:", answers: [ { text: "Your emergency fund is fully stocked.", motive: "Security" }, { text: "You have a rich collection of memories and stories.", motive: "Experience" }, { text: "You can help someone in need without worrying.", motive: "Generous" }, { text: "People notice and admire your lifestyle.", motive: "Status" } ] },
            { question: "Which phrase resonates with you most?", answers: [ { text: "Slow and steady wins the race.", motive: "Security" }, { text: "Collect moments, not things.", motive: "Experience" }, { text: "It's better to give than to receive.", motive: "Generous" }, { text: "You get what you pay for.", motive: "Status" } ] },
            { question: "A 'rich life' to you means:", answers: [ { text: "Never having to worry about money.", motive: "Security" }, { text: "Freedom to travel and explore.", motive: "Experience" }, { text: "The ability to support your community.", motive: "Generous" }, { text: "Enjoying the best of everything.", motive: "Status" } ] }
        ];
        
        const archetypes = {
            Security: { title: "The Security Seeker", icon: '<i data-lucide="shield-check" class="w-16 h-16 text-green-500"></i>', description: "You are motivated by stability and peace of mind. You find comfort in planning, saving, and knowing you're prepared for the future.", strengths: "Excellent at saving, disciplined, and great at long-term planning.", blinds: "May be overly risk-averse, potentially missing out on growth opportunities. Can sometimes delay gratification to an extent that they forget to enjoy the present.", mantra: "My financial plan gives me the freedom to be secure today and enjoy tomorrow." },
            Experience: { title: "The Experience Chaser", icon: '<i data-lucide="map" class="w-16 h-16 text-yellow-500"></i>', description: "You believe life is about the memories you make, not the things you own. You prioritize spending on travel, events, and activities that enrich your life.", strengths: "Lives a rich and fulfilling life full of stories. Understands that value isn't always monetary.", blinds: "Can struggle with long-term savings goals. May prioritize a short-term adventure over a long-term need, like retirement savings.", mantra: "I can build a future that funds my adventures and secures my peace." },
            Generous: { title: "The Generous Giver", icon: '<i data-lucide="heart-handshake" class="w-16 h-16 text-pink-500"></i>', description: "You find the greatest joy in using your resources to help others. Your financial decisions are often guided by your heart.", strengths: "Deeply empathetic and builds strong community bonds. Finds immense fulfillment in helping others.", blinds: "May neglect their own financial needs, a classic 'put your own oxygen mask on first' scenario. Can sometimes be taken advantage of financially.", mantra: "Securing my own finances is the most powerful way I can continue to help others." },
            Status: { title: "The Status Symbolist", icon: '<i data-lucide="gem" class="w-16 h-16 text-purple-500"></i>', description: "You appreciate quality, craftsmanship, and the finer things in life. You see money as a tool to achieve a certain lifestyle.", strengths: "Often highly driven and successful. Has a clear vision for the life they want to build.", blinds: "Susceptible to lifestyle inflation. May tie self-worth too closely to material possessions, leading to a never-ending cycle of spending.", mantra: "I define my success; my possessions do not. True wealth is freedom." }
        };
        
        let currentQuestionIndex = 0;
        let motiveScores = {};
        
        function startQuiz(elements) {
            currentQuestionIndex = 0;
            motiveScores = { Security: 0, Experience: 0, Generous: 0, Status: 0 };
            elements.quizContainer.classList.remove('hidden');
            elements.motiveResultContainer.classList.add('hidden');
            displayQuestion(elements);
        }
        
        function displayQuestion(elements) {
            const questionData = quizData[currentQuestionIndex];
            elements.quizQuestion.textContent = questionData.question;
            elements.quizOptions.innerHTML = '';
            questionData.answers.forEach(answer => {
                const button = document.createElement('button');
                button.className = 'quiz-option p-4 rounded-lg text-left';
                button.textContent = answer.text;
                button.onclick = () => selectAnswer(answer.motive, elements);
                elements.quizOptions.appendChild(button);
            });
            const progress = ((currentQuestionIndex) / quizData.length) * 100;
            elements.quizProgress.style.width = `${progress}%`;
        }
        
        function selectAnswer(motive, elements) {
            motiveScores[motive]++;
            currentQuestionIndex++;
            if (currentQuestionIndex < quizData.length) {
                displayQuestion(elements);
            } else {
                showResults(elements);
            }
        }
        
        function showResults(elements) {
            const finalMotive = Object.keys(motiveScores).reduce((a, b) => motiveScores[a] > motiveScores[b] ? a : b);
            userMotive = finalMotive;
            const archetype = archetypes[finalMotive];
            
            elements.archetypeIcon.innerHTML = archetype.icon;
            elements.archetypeTitle.textContent = archetype.title;
            elements.archetypeDescription.textContent = archetype.description;
            elements.archetypeStrengths.textContent = archetype.strengths;
            elements.archetypeBlinds.textContent = archetype.blinds;
            elements.archetypeMantra.textContent = `"${archetype.mantra}"`;
            
            elements.quizContainer.classList.add('hidden');
            elements.motiveResultContainer.classList.remove('hidden');
            lucide.createIcons();
        }
        
        // --- Dynamic Facts Logic ---
        function displayDynamicFact(tab, elements) {
            const age = parseInt(elements.age.value) || 30;
            const gender = elements.gender.value;
            const factContainer = document.getElementById(`${tab}-fact`);
            if (!factContainer) return;
            let facts = [];
            
            // Age-based facts
            if (age < 30) {
                facts.push("Did you know? Thanks to compound interest, a dollar saved in your 20s can be worth nearly 15 times as much as a dollar saved in your 50s.");
            } else if (age >= 50) {
                facts.push("Food for thought: The average healthcare cost for a retired couple is over $300,000. Planning for this now creates peace of mind for later.");
            }
            
            // Gender-based facts
            if (gender === 'female') {
                facts.push("On average, women live longer than men, meaning retirement savings need to last longer. Every dollar invested today is an investment in your future independence.");
            }
            
            // Motive-based facts
            if (userMotive === 'Security') {
                facts.push("A study found that people with a stocked emergency fund report significantly lower stress levels, regardless of their income.");
            } else if (userMotive === 'Experience') {
                facts.push("Research from Cornell University shows that the happiness from experiential purchases lasts far longer than the happiness from material ones.");
            } else if (userMotive === 'Generous') {
                facts.push("Strategic giving, like donating appreciated stocks, can often provide a larger tax benefit, allowing you to give even more to the causes you love.");
            } else if (userMotive === 'Status') {
                facts.push("The average new car loses about 20% of its value in the first year. Investing that difference could be worth tens of thousands in the future.");
            }
            
            // Default facts if no specific ones match
            if (facts.length === 0) {
                facts.push("The S&P 500 has historically returned an average of about 10% per year. Investing is one of the most powerful tools for building wealth.");
                facts.push("A 'latte factor' of $5 a day adds up to $1,825 a year. Invested, that could be over $100,000 in 30 years.");
            }
            
            const randomFact = facts[Math.floor(Math.random() * facts.length)];
            factContainer.innerHTML = `<p class="text-yellow-200"><i class="inline-block" data-lucide="lightbulb"></i> <strong>Food for Thought:</strong> ${randomFact}</p>`;
            factContainer.classList.remove('hidden');
            lucide.createIcons();
        }
        
        // --- Event Listeners and Initial Load ---
        function initializeApp() {
            // --- DOM Elements ---
            const elements = {
                // Main Inputs
                age: document.getElementById('age'),
                gender: document.getElementById('gender'),
                itemName: document.getElementById('itemName'),
                itemCost: document.getElementById('itemCost'),
                preTaxHourlyIncome: document.getElementById('preTaxHourlyIncome'),
                location: document.getElementById('location'),
                paycheckFrequency: document.getElementById('paycheckFrequency'),
                currentSavings: document.getElementById('currentSavings'),
                monthlyExpenses: document.getElementById('monthlyExpenses'),
                debtAmount: document.getElementById('debtAmount'),
                debtInterestRate: document.getElementById('debtInterestRate'),
                // Results Display
                resultsSection: document.getElementById('results-section'),
                resultItemName: document.getElementById('resultItemName'),
                totalCostWithTax: document.getElementById('totalCostWithTax'),
                netIncomeDisplay: document.getElementById('netIncomeDisplay'),
                hoursWorked: document.getElementById('hoursWorked'),
                daysWorked: document.getElementById('daysWorked'),
                hoursLeft: document.getElementById('hoursLeft'),
                lifePercentage: document.getElementById('lifePercentage'),
                paycheckPercentage: document.getElementById('paycheckPercentage'),
                freedomFundCard: document.getElementById('freedom-fund-card'),
                runwayMonths: document.getElementById('runwayMonths'),
                runwayAdded: document.getElementById('runwayAdded'),
                // Debt
                debtTotal: document.getElementById('debtTotal'),
                debtRate: document.getElementById('debtRate'),
                debtPayment: document.getElementById('debtPayment'),
                debtExtra: document.getElementById('debtExtra'),
                monthlyIncome: document.getElementById('monthlyIncome'),
                creditScore: document.getElementById('creditScore'),
                totalMonthlyPayment: document.getElementById('totalMonthlyPayment'),
                // Investment
                initialInvestment: document.getElementById('initialInvestment'),
                monthlyContribution: document.getElementById('monthlyContribution'),
                timeHorizon: document.getElementById('timeHorizon'),
                stocksAllocation: document.getElementById('stocksAllocation'),
                bondsAllocation: document.getElementById('bondsAllocation'),
                goldAllocation: document.getElementById('goldAllocation'),
                btcAllocation: document.getElementById('btcAllocation'),
                otherAllocation: document.getElementById('otherAllocation'),
                inflationRate: document.getElementById('inflationRate'),
                showRealReturns: document.getElementById('showRealReturns'),
                // Financial Health
                healthIncome: document.getElementById('healthIncome'),
                healthExpenses: document.getElementById('healthExpenses'),
                healthSavings: document.getElementById('healthSavings'),
                healthDebt: document.getElementById('healthDebt'),
                // Quiz
                quizContainer: document.getElementById('quiz-container'),
                motiveResultContainer: document.getElementById('motive-result-container'),
                quizQuestion: document.getElementById('quizQuestion'),
                quizOptions: document.getElementById('quizOptions'),
                quizProgress: document.getElementById('quiz-progress'),
                archetypeIcon: document.getElementById('archetypeIcon'),
                archetypeTitle: document.getElementById('archetypeTitle'),
                archetypeDescription: document.getElementById('archetypeDescription'),
                archetypeStrengths: document.getElementById('archetypeStrengths'),
                archetypeBlinds: document.getElementById('archetypeBlinds'),
                archetypeMantra: document.getElementById('archetypeMantra'),
                // Goals
                goalName: document.getElementById('goalName'),
                goalAmount: document.getElementById('goalAmount'),
                currentGoalSavings: document.getElementById('currentGoalSavings'),
                goalTrackerSection: document.getElementById('goal-tracker-section'),
                goalResultName: document.getElementById('goalResultName'),
                goalItemName: document.getElementById('goalItemName'),
                goalContribution: document.getElementById('goalContribution'),
                // Retirement
                retireAge: document.getElementById('retireAge'),
                annualIncome: document.getElementById('annualIncome'),
                currentRetireSavings: document.getElementById('currentRetireSavings'),
                savingsRate: document.getElementById('savingsRate'),
                annualExpenses: document.getElementById('annualExpenses'),
                retirementDream: document.getElementById('retirementDream'),
                retirementResultsSection: document.getElementById('retirement-results-section'),
                dreamDisplay: document.getElementById('dreamDisplay'),
                retirementAgeResult: document.getElementById('retirementAgeResult'),
                fiNumberResult: document.getElementById('fiNumberResult'),
                withdrawalResult: document.getElementById('withdrawalResult'),
                retireItemName: document.getElementById('retireItemName'),
                purchaseImpactResult: document.getElementById('purchaseImpactResult'),
                retirementMeaning: document.getElementById('retirementMeaning'),
                timeValueTable: document.getElementById('timeValueTable')
            };
            
            // --- Event Listeners ---
            document.getElementById('calculateBtn').addEventListener('click', () => calculatePurchase(elements));
            document.getElementById('debtBtn').addEventListener('click', () => calculateDebtPayoff(elements));
            document.getElementById('healthBtn').addEventListener('click', () => calculateFinancialHealth(elements));
            document.getElementById('setGoalBtn').addEventListener('click', () => setGoal(elements));
            document.getElementById('calculateRetireBtn').addEventListener('click', () => handleRetirementCalculation(elements));
            document.getElementById('retakeQuizBtn').addEventListener('click', () => startQuiz(elements));
            
            // Investment scenario event listeners
            document.getElementById('initialInvestment').addEventListener('input', updateScenarioInputs);
            document.getElementById('monthlyContribution').addEventListener('input', updateScenarioInputs);
            document.getElementById('timeHorizon').addEventListener('input', updateScenarioInputs);
            document.getElementById('stocksAllocation').addEventListener('input', updateScenarioInputs);
            document.getElementById('bondsAllocation').addEventListener('input', updateScenarioInputs);
            document.getElementById('goldAllocation').addEventListener('input', updateScenarioInputs);
            document.getElementById('btcAllocation').addEventListener('input', updateScenarioInputs);
            document.getElementById('otherAllocation').addEventListener('input', updateScenarioInputs);
            document.getElementById('inflationRate').addEventListener('input', updateScenarioInputs);
            document.getElementById('showRealReturns').addEventListener('change', updateScenarioInputs);
            document.getElementById('applyRecommendedBtn').addEventListener('click', applyRecommendedAllocation);
            document.getElementById('addScenarioBtn').addEventListener('click', addScenario);
            document.getElementById('resetScenariosBtn').addEventListener('click', resetScenarios);
            
            // Make removeScenario globally accessible
            window.removeScenario = removeScenario;
            
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', () => {
                    switchTab(button.dataset.tab);
                });
            });
            
            // Add fade-in animation to elements
            document.querySelectorAll('.result-card').forEach((card, index) => {
                card.style.animationDelay = `${index * 0.1}s`;
                card.classList.add('fade-in-up');
            });
            
            lucide.createIcons();
            startQuiz(elements); 
        }
    </script>
</body>
</html>